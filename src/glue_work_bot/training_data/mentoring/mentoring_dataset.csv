body
"Regarding the precise values used in the `_vs2026Response` data for the test:
```
MINGW64 $ ./vswhere -prerelease | grep -E 'displayName|installationVersion|productDisplayVersion'
installationVersion: 18.0.11116.177
displayName: Visual Studio Community 2026
catalog_productDisplayVersion: Insiders [11116.177]

MINGW64 $
```"
"Huh. Weird. Git says that upstream `master` doesn't share any history in common with my fork `master`, and as such, it isn't possible to merge the latest upstream `master` into this branch. I hope it's okay to just re-apply this commit onto upstream `master` using `cherry-pick` and force-push the branch."
"I checked the Google testing failures, they looked like flakes unrelated to your change. Rerunning..."
üéâ 
"please i just downloaded visual studio 2026 community version today and still flutter cannot see it, please help
"
why this changes not in stable branch now?
"> The major thing I didn't quite get was how incoming pixel format could be ""optimal"".

It couldn't be, that would result in a runtime error.  The PixelFormat type has 2 uses, it defines the input format for decoding pixels and it defines the target pixel format for the texture.  Not all values are valid for for each of those inputs.  Alternatively we could have made a different enum ""TargetPixelFormat""?"
"> Alternatively we could have made a different enum ""TargetPixelFormat""

Ooh. I really like that idea. Instead of conflating the two ideas."
"@chinmaygarde thanks for giving it another look, i responded to all your comments but I forgot to hit ""submit"" then github lost them."
"> It does bug me that we lose any set ColorScheme.surface because that's only in the Material library. Maybe we can add a surfaceColor to the parameters in the constructor for the transitions builder? To at least make it customizable. Then users in the Material library can add ColorScheme.of(context).surface as that property.

Background color is there already, which overrides ColorScheme.surface if given. So, we might not need another property."
"In regard to the color situation, I think the current approach may not be ideal. The existing customer would have to set the background color from color scheme to preserve the existing behavior. We should avoid making the code to be more verbose if possible.

I can think of 2 way forward:

1. have a DefaultPageTransitionStyle similar to DefaultTextStyle and DefaultSelectionStyle...etc. The material theme will builds a DefaultPageTransitionStyle based on its ColorTheme

2. Make the widget version's TransitionBuilder's color or other material theme related properties to be required properties. The material library still retain these class, but instead it builds on top of the widget version's with its require properties infer from material theme "
"My opinion on the surface/ background color is that the current builder needs to work as-is with no migration when moved to the widgets layer. If that's not possible, then we need to make a new class name which the Material version would extend off of to add Material specific behavior. In this case getting the surface color from theme.

For the widgets version, I think I'm leaning towards making the property required. We can make a lot of good guesses on a suitable default, but we can't guarantee anything, so I think requiring the background color is necessary."
I have added `FadeForwardsTransitionBuilder` as widgets version of `FadeForwardsPageTransitionBuilder` which just delegates its transition to widgets version with surface color.
"I am not sure about naming of `FadeForwardsPageTransitionBuilder`, so please feel free to suggest better name."
"I synced up with @Piinks offline and she was of the opinion that creating a new class just to resolve the ColorScheme.surface dependency seems overkill. At worst, leaving the transitions builder in the Material library might be the answer here.

Requiring the background color is a breaking change, but also a viable alternative to make developers intentional about what color they want to use. This can sort of 'cover up' the fact that the default fallback color is changing.

Research on real-life codebases using FadeForwardsPageTransitionsBuilder directly can inform the decision to be made here. "
@victorsanni so whats the conclusion? Just move FadeForwardsPageTransitionsBuilder to widgets with backgroundColor as required
"> whats the conclusion? Just move FadeForwardsPageTransitionsBuilder to widgets with backgroundColor as required

I'd recommend pausing this particular PR for now while we keep discussing the available options here. But feel free to open PRs for the other transition builders in the meantime."
"> I'd recommend pausing this particular PR for now while we keep discussing the available options here. But feel free to open PRs for the other transition builders in the meantime.

Hey @victorsanni, I think we need to make a decision before proceeding further.

The remaining transition builders are ZoomPageTransitionsBuilder and CupertinoPageTransitionBuilder, but both have dependencies that need to be addressed:

  1. **ZoomPageTransitionsBuilder** - Has a dependency on surface color, similar to FadeForwardsPageTransitionsBuilder
  2. **CupertinoPageTransitionBuilder** - Is fully dependent on CupertinoRoute"
"@QuncCccccc authored FadeForwardsPageTransitionsBuilder in this [PR](https://github.com/flutter/flutter/pull/158881). From reading through the PR description and comments, it seems that `ColorScheme.surface` is used as a fallback to avoid a jarring black background color (and not necessarily an M3 specification). 

I'm of the opinion that we should move the class to `widgets/`, make `backgroundColor` required, and dart fix constructors that don't  provide a background color to provide `ColorScheme.of(context).surface`. The `required` break will force users to be intentional about what color they use here, and the dart fix will help preserve current behavior.

What do y'all think?"
"> @QuncCccccc authored FadeForwardsPageTransitionsBuilder in this https://github.com/flutter/flutter/pull/158881. From reading through the PR description and comments, it seems that ColorScheme.surface is used as a fallback to avoid a jarring black background color (and not necessarily an M3 specification).
I'm of the opinion that we should move the class to widgets/, make backgroundColor required, and dart fix constructors that don't provide a background color to provide ColorScheme.of(context).surface. The required break will force users to be intentional about what color they use here, and the dart fix will help preserve current behavior.
What do y'all think?

Makes sense to me."
"I'm not sure the top gap should be set as a pixel value. Instead it might be better as a ratio of the screen height, from 0 to 1.0. So 0.5 would be half screen. That would be safer with looking correct across different screen sizes."
"@MitchellGoodwin Reverted the delegatedTransition Change and updated canTransition methods with topGap, but i think test are still failing, I tested it on device, looks fine but might have missed any edge case."
Are there any updates on this? Could we get this merged at this point?
@erkinovalim We still need review.
"@MitchellGoodwin could you review this please?
"
@MitchellGoodwin could you review this please?
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"Test Exemption Justification:
This PR only changes assertion messages in the Tab widget to improve developer clarity.
It does not alter any behavior, logic, or API, and therefore does not require new tests.
Test Exemption Justification:
This PR only changes assertion messages in the Tab widget to improve developer clarity.
It does not alter any behavior, logic, or API, and therefore does not require new tests."
"<img width=""1231"" height=""972"" alt=""image"" src=""https://github.com/user-attachments/assets/38cb3662-1e09-4e7c-bc7e-721fdec8d307"" />
"
@woprandi ‚Äì amazing! thanks!
"> Is it possible to link to a ignore-locking.md file in the root?

@reidbaker It seems like moving to a single file is causing the tests to fail again.  It may be because there is not a full repo checkout in the shards?  https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8699826480735377169/+/u/run_test.dart_for_build_tests_shard_and_subshard_1_5/stdout"
@jtmcdole is there a simple explanation you can add here that does not require you to dig into the code? 
"> @jtmcdole is there a simple explanation you can add here that does not require you to dig into the code? 

For the test errors or...?"
"> > Is it possible to link to a ignore-locking.md file in the root?
> 
> @reidbaker It seems like moving to a single file is causing the tests to fail again. It may be because there is not a full repo checkout in the shards? https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8699826480735377169/+/u/run_test.dart_for_build_tests_shard_and_subshard_1_5/stdout

You get a [full fetch](https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8699826480735377169/+/u/Checkout_flutter_flutter/git_fetch/stdout) and [full checkout](https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8699826480735377169/+/u/Checkout_flutter_flutter/git_checkout/stdout). "
"- I checked out the tree locally, the file exists.
- `git grep` shows its referenced as relative files (`../../tools/bin/config/.ignore-locking.md`)

I suspect its because the tests are being run from the root of the tree. Suggest testing locally from the root of the tree:

```
SHARD=build_tests SUBSHARD=1_5 dart --enable-asserts dev/bots/test.dart
```"
"> * I checked out the tree locally, the file exists.
> * `git grep` shows its referenced as relative files (`../../tools/bin/config/.ignore-locking.md`)
> 
> I suspect its because the tests are being run from the root of the tree. Suggest testing locally from the root of the tree:
> 
> ```
> SHARD=build_tests SUBSHARD=1_5 dart --enable-asserts dev/bots/test.dart
> ```

Tested locally and it passed.  I changed the Gradle files to use a ""relative"" path from the absolute ${rootProject.projectDir} - I think that should fix it. 

```
file(""${rootProject.projectDir}/../../tools/bin/config/.ignore-locking.md"")
```
"
"> > @jtmcdole is there a simple explanation you can add here that does not require you to dig into the code?
> 
> For the test errors or...?

Sorry should have indicated I was looking for if we did not do a full checkout. Thank you for digging in anyway. "
This docs update needs further review by partner teams. Closing for now while we discuss internally.
/gemini review
@ditman ‚Äì¬†tests added!
@evantea Let me know if this won't solve your problem!
"@justinmc copied this commit into my local workspace, using only the ""Remove Animations"" system setting images, GIFs paused automatically (though only after rebuilding the view). Thanks for putting this together!"
"@chunhtai This is ready for re-review, but it seems to be failing a skwasm test in a way that I can't reproduce locally. See my comment at https://github.com/flutter/flutter/pull/176492#discussion_r2418059865. Since this is a P1, maybe I should split out the image source swapping fix into a follow-up PR. Interested in what you think."
"Hi @justinmc does this pr fixes https://github.com/flutter/flutter/issues/130976? I saw the pr is marked so in the description, but not sure whether that is the case"
"@chunhtai I guess this only helps with Image, but that issue seems more broad. I will edit the description."
"There are legitimate Google test failures where images don't load, I'm investigating."
"@mdebbar Great catch, sorry for that! I did that as a test and forgot about it. I'll unrevert it and sync with master and see if it passes now."
Wasm tests appear to be passing now :+1: 
"Code I'm using to test this:

<details>

<summary>Code</summary>

```dart
import 'package:flutter/material.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(primarySwatch: Colors.blue),
      home: const MyHomePage(title: 'Flutter Demo Home Page'),
    );
  }
}

class MyHomePage extends StatelessWidget {
  const MyHomePage({super.key, required this.title});

  final String title;

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text(title)),
      body: Center(
        child: Row(
          mainAxisAlignment: MainAxisAlignment.spaceAround,
          children: <Widget>[
            _PlayableGif(
              assetImage: AssetImage('assets/nyan.gif'),
              assetImageAlt: AssetImage('assets/nyan_alt.gif'),
            ),
            _PlayableGif(
              assetImage: AssetImage('assets/quality.gif'),
              assetImageAlt: AssetImage('assets/quality_alt.gif'),
            ),
          ],
        ),
      ),
    );
  }
}

class _PlayableGif extends StatefulWidget {
  const _PlayableGif({required this.assetImage, required this.assetImageAlt});

  final AssetImage assetImage;
  final AssetImage assetImageAlt;

  @override
  State<_PlayableGif> createState() => _PlayableGifState();
}

class _PlayableGifState extends State<_PlayableGif> {
  bool _isPaused = true;
  bool _isOriginal = true;

  @override
  Widget build(BuildContext context) {
    return Column(
      mainAxisAlignment: MainAxisAlignment.center,
      children: <Widget>[
        ConstrainedBox(
          constraints: BoxConstraints.loose(Size(300.0, 300.0)),
          //child: Image(image: widget.assetImage, isPaused: _isPaused),
          /*
          child: TickerMode(
            enabled: !_isPaused,
            child: Image(image: widget.assetImage),
          ),
          */
          child: MediaQuery(
            data: MediaQueryData(disableAnimations: _isPaused),
            child: Image(
              image: _isOriginal ? widget.assetImage : widget.assetImageAlt,
            ),
          ),
        ),
        SizedBox(height: 64.0),
        Row(
          children: <Widget>[
            TextButton(
              onPressed: () {
                setState(() {
                  _isPaused = !_isPaused;
                });
              },
              child: Text(switch (_isPaused) {
                true => 'Play',
                false => 'Pause',
              }),
            ),
            SizedBox(height: 64.0),
            TextButton(
              onPressed: () {
                setState(() {
                  _isOriginal = !_isOriginal;
                });
              },
              child: Text(switch (_isOriginal) {
                true => 'Show alt',
                false => 'Show original',
              }),
            ),
          ],
        ),
      ],
    );
  }
}
```

</details>"
I have a local commit to revert https://github.com/flutter/flutter/pull/176492/commits/a28b26a1ac35f6eab2903f55aa026fec262b6921 that I will push as soon as my fix for the Google tests is merged.
Google tests have been fixed in Google internal cl/829551684. Now triggering a re-run to confirm that they pass with this PR applied.
@Masrafi Would you be able to fix the failures here?
"@justinmc 
Hi, thanks for the ping!

Yes, I will definitely be fixing the failures.

I believe the environmental issues are now resolved (I pushed a re-synced commit to re-trigger the checks), so I'm now entirely focused on debugging the 21 logic regressions caused by my change to Navigator.pop.

These failures are likely cascading from one root bug in the framework. To speed up the process, could you potentially share the name of the first test that failed in the Linux framework_tests_widgets job? Knowing that specific test will help me pinpoint the root cause much faster."
"@Masrafi I think you should be able to see the test failure logs yourself, let me know if not: https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8699524588455296913/+/u/run_test.dart_for_framework_tests_shard_and_subshard_widgets/stdout

```
 01:05 +1328 ~2: /b/s/w/ir/x/w/flutter/packages/flutter/test/widgets/navigator_restoration_test.dart: restorablePopAndPushNamed
 ‚ïê‚ïê‚ï° EXCEPTION CAUGHT BY FLUTTER TEST FRAMEWORK ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 The following assertion was thrown running a test:
 Navigator operation requested with no present routes. Ensure there is at least one route before
 calling Navigator.pop().
 When the exception was thrown, this was the stack:
 #0      NavigatorState.pop.<anonymous closure> (package:flutter/src/widgets/navigator.dart:5627:15)
 #1      NavigatorState.pop (package:flutter/src/widgets/navigator.dart:5633:10)
 #2      NavigatorState.restorablePopAndPushNamed (package:flutter/src/widgets/navigator.dart:4914:5)
 #3      main.<anonymous closure> (file:///b/s/w/ir/x/w/flutter/packages/flutter/test/widgets/navigator_restoration_test.dart:110:10)
 <asynchronous suspension>
 #4      testWidgets.<anonymous closure>.<anonymous closure> (package:flutter_test/src/widget_tester.dart:192:15)
 <asynchronous suspension>
 #5      TestWidgetsFlutterBinding._runTestBody (package:flutter_test/src/binding.dart:1059:5)
 <asynchronous suspension>
 <asynchronous suspension>
 (elided one frame from package:stack_trace)
 The test description was:
   restorablePopAndPushNamed
 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 01:05 +1328 ~2 -1: /b/s/w/ir/x/w/flutter/packages/flutter/test/widgets/raw_radio_test.dart: Raw Radio accessibility announcements on various platforms Unselected radio should be vocalized via hint on iOS/macOS platform
 01:05 +1328 ~2 -1: /b/s/w/ir/x/w/flutter/packages/flutter/test/widgets/navigator_restoration_test.dart: restorablePopAndPushNamed [E]
   Test failed. See exception logs above.
   The test description was: restorablePopAndPushNamed
   

```"
"@justinmc 
Hi, I solved some fail check. Can you assist me to help the rest of the fail?"
"I'm still trying something out, but it's ready for review. "
@yjbanov just FYI since you are working on something related on the web.
"Did some research on iPad trackpad: 

For trackpad touches, it's still a `UIEventTypeTouch` (indirect), not a `UIEventTypePress`. 
For trackpad scrolls, it triggers `UIEventTypeScroll`, so we still want the same logic in `hitTest`, so we can block the scroll too. 
"
"I tried using this PR to compile the local engine, but I couldn‚Äôt build the iOS project ‚Äî it shows an error. The setter 'onPlatformViewShouldAcceptGesture' isn't defined for the type 'PlatformDispatcher'. 
Please double-check if it‚Äôs breaking the current API.
"
(triage) @hellohuanlin is this pr ready for another look?
"> One potential issue is that this may result in usages of `toImageSync` that are safe when using Impeller but consume excessive resources on platforms that are still using Skia. App developers will need to be aware of this as long as Skia remains in use.

I think that's fine because this isn't the only place this happens.  Impeller was created with the intention to be a renderer with better performance for Flutter's use case.  That means there are all sorts of usages that are supposed to be better on impeller than on skia.  We don't want logical changes, but performance changes are expected."
Please advise if this issue is insufficiently trivial to be exempt from a dedicated issue.
"Gemini emitted a huge number of identical suggestions that the wording be changed. Gemini's analysis assumed that I was imprecise in my choice of words, but this is not the case, and Gemini's suggestion says something explicitly different from what I intended."
(`NULL` should have been `%NULL`)
"Mostly for the purposes of anyone who might stumble across this bug in the future - the recommended use of GError is to use `g_autoptr` to avoid accidentally leaking the error, i.e. the above case becomes:
```c
    // CORRECT CODE
    g_autoptr(GError) error = nullptr;

    if (!fl_method_call_respond_success(method_call, result_value, &error)) {
      g_warning(""Failed to send Flutter Platform Channel response: %s"", error->message);
    }
```"
@QuncCccccc Can you please review this PR ?
"> Thanks for your contribution!
> 
> I compared the native SegmentedControl behavior with the newly added behavior here, and they look quite different.
> 
> For native component, when momentary is turned on and we tap/press a segment, the text would animate a little and go back to the original size, and onValueChanged is still get called when we tap one of the segments.
> 
>  Screen.Recording.2025-03-14.at.3.17.01.PM.mov 
> I'm not sure what would be the use case of momentary flag, but if we really need this feature, we might want to match the native behavior as much as possible:)

Sure, I'll try to match as much as possible.

Edit :- Have allowed onValueChanged onTap and also Updated onTap animation."
"> Thanks for sending another PR! Can you add a dartpad sample to the docs that demonstrates this?

Sure, I can add dartpad sample."
"Hey @rkishan516, this is the type of change we want to make sure has high fidelity with the native feature. Can you update the PR description with visuals to demonstrate the native behavior and what you are adding here? I see some of the earlier feedback here found some issues when trying to compare. 

In general, it's preferred to provide a more detailed explanation of your change in PR descriptions. Thank you!"
"> Hey @rkishan516, this is the type of change we want to make sure has high fidelity with the native feature. Can you update the PR description with visuals to demonstrate the native behavior and what you are adding here? I see some of the earlier feedback here found some issues when trying to compare.
> 
> In general, it's preferred to provide a more detailed explanation of your change in PR descriptions. Thank you!

Sure @Piinks, I will update description."
"Hi! Sorry I missed it in my review queue lately. Not sure if it's due to your fixes (which I greatly appreciate!), I found that your tests are passing.
* The test snippet you posted in the comment passes.
* The unit test added in this PR passes without extra configuration:
```dart
  testWidgets('CupertinoSlidingSegmentedControl with momentary scales up selected segment', (
    WidgetTester tester,
  ) async {
    const Map<int, Widget> children = <int, Widget>{0: Text('A'), 1: Text('BB'), 2: Text('CCCC')};

    groupValue = 1;
    await tester.pumpWidget(
      boilerplate(
        builder: (BuildContext context) {
          return CupertinoSlidingSegmentedControl<int>(
            isMomentary: true,
            children: children,
            groupValue: groupValue,
            onValueChanged: defaultCallback,
          );
        },
      ),
    );

    final TestGesture gesture = await tester.startGesture(tester.getCenter(find.text('A')));
    final Finder scaleTransition = find.ancestor(
      of: find.text('A'),
      matching: find.byType(ScaleTransition),
    );

    // We don't need the pump duration (which specifies frame duration, not total duration)
    await tester.pumpAndSettle();
    double scale = tester.widget<ScaleTransition>(scaleTransition).scale.value;
    expect(scale, greaterThan(1.0));

    await gesture.up();

    await tester.pumpAndSettle();
    scale = tester.widget<ScaleTransition>(scaleTransition).scale.value;
    // It doesn't need the larger tolerance any more
    expect(scale, moreOrLessEquals(1.0));
  });
```

I guess that means the biggest obstacle of this PR is solved? Are there anything else we should solve first or do you think we should give it another detailed review?"
"Hey @dkwingsmt Test were passing, just that spring simulation at the end should be equals to 1.0 not moreOrLessEqual to 1.0. Just waiting for your thoughts on that."
"@rkishan516 `moreOrLessEqual ` is ok. By default it uses a precisionTolerance which is useful to compare the equality of floats while avoiding floating precision errors.

I'll do another full review soon then! Thank you."
test-exempt: code refactor with no semantic change
" @bkonyi please fill out the PR description above, afterwards the release team will review this request."
" @bkonyi please fill out the PR description above, afterwards the release team will review this request."
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"I tested this fix by changing `<key>MinimumOSVersion</key>` in `ios/Flutter/AppFrameworkInfo.plist` to `99.0` and then running `flutter-dev build ios --release --no-codesign`,  and then `plutil -p ""build/ios/Release-iphoneos/App.framework/Info.plist"" | grep ""MinimumOSVersion""` which gives me `""MinimumOSVersion"" => ""13.0""`"
I'm trying to get clarity on what this is actually trying to fix. See https://github.com/flutter/flutter/issues/176313#issuecomment-3523999946
"I need your help @loic-sharma, I have a leak test failing and I believe it is because of `assert()` which checks if tween is valid (has begin and end). I don't know how to solve that. I can move the assert to the constructor, but then it can't be `const`, or I can just remove the assert (but then if someone forgets begin or end will get runtime issues). What do you think? Shall I remove `const` or is there a simple good way to solve this problem?"
"@bernaferrari I would go ahead and make the widget non-`const` for now.

It looks like leaking objects in exceptional situations (like a test for error conditions) is a known issue: https://github.com/flutter/flutter/issues/157470. When we fix this, we can make this widget `const` :)"
"Well, I finished it, but I guess I took too long :( This completely breaks my PR: https://github.com/flutter/flutter/pull/174605

We can still merge it, but I think it will only be useful for samples. The biggest reason for this PR (progress indicator) is now even more complex with custom controller. I could do something like, if no custom controller is provided, use `RepeatingTweenAnimationBuilder` else do the standard behavior, but it will be duplicated code, so I'm not sure how to progress.

We can:
- When not using custom controller, use `RepeatingTweenAnimationBuilder` (but might have duplicated rendering logic)
- I guess allow custom `AnimationController` inside `RepeatingTweenAnimationBuilder`
- Merge but only use on examples, not on ProgressIndicator
- Don't merge.

Any thoughts? For now, I'm going for option 1, it is a bit more code but should work. I'll fix whatever is causing the golden later (interesting there was no golden issue before)."
"@bernaferrari Hey there, sorry for the long response time on my end. I think we should still merge this and use it only for examples:

1. Let's make `RepeatingTweenAnimationBuilder`'s builder accept a `T` instead of `Animation<T>`. See [this comment](https://github.com/flutter/flutter/pull/174014#discussion_r2377296222) for details.
2. Use `RepeatingTweenAnimationBuilder` conservatively where it is clearly the right choice. I wouldn't update the progress indicators if that requires multiple rendering

This is still a good first step! We can continue to make `RepeatingTweenAnimationBuilder` more powerful (by expanding it to the `Animation<T>` pattern) later to use this in more areas :)"
Hi @bernaferrari ! Are you able to address the comments above so we can work together to get this landed?
"Yes, yes. I'll update it today"
"Ok. Sorry for the loooooong wait. I think I commited everything we talked about. The examples surface got (drastically) reduced and I'm using ""double"" so it matches the TweenBuilder. I am a bit ü§® because I wish it could be more useful, but I don't know how. With `FadeTransition` (etc) it gets super nasty, and `ProgressIndicator` got their own implementation. So it feels we are still looking for a ""better"" and ""clean"" solution for them."
This is looking really good. That sample app is a work of art. Excellent work! :)
I think I addressed every comment. Thanks for all the suggestions. I think I rewrote this PR two or three times already. It is getting better every time.
@bernaferrari FYI there's an analyzer failure here.
"Oh, thanks @justinmc, I really had not seen that. Fixed the unused  import. Thanks!"
I didn't re-request anything but I guess that's automated when I force pushed to latest. But feel free to review again if/when you want.
Flyby comment from triage: it looks like there are a number of failing checks here.
"Oh, I think tree was down. I'll rebase."
Should I call `autosubmit` or does anyone want to review anything? @loic-sharma 
"@bernaferrari Let me take another look tomorrow since there were significant changes since I approved. Thanks for bearing with us, we‚Äôre almost there! üòÇ "
@QuncCccccc @Piinks 
"> @Mairramer it feels like we have not been able to work out a solution here that works to satisfy the feature request. I understand you've put a lot of time into this, and your contributions are greatly appreciated, but there is still feedback that has been left unaddressed. I am not sure we can continue reviewing this change without significant changes that address the issues that have been pointed out, repeatedly in some cases.
> 
> Is this a change you would like to continue working on?

Yes, I‚Äôll continue working on it. I‚Äôm adjusting the code to meet the requirements of the implementation ‚Äî although I did get a bit stuck along the way.
"
"An existing Git SHA, `e39651ed0178e5e8afa4a25af7193f2a76b0ddde`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
/gemini review 
"@Piinks After a long time, I came back to this implementation. I believe it‚Äôs now more consistent."
Towards https://github.com/flutter/flutter/issues/178400
"Currently has merge conflicts in the merge queue. Please try re-landing in a while.

<img width=""976"" height=""75"" alt=""image"" src=""https://github.com/user-attachments/assets/7120da98-e25c-43c8-8395-1e3f67130332"" />
"
@bc-lee one open question on why you removed outputs.upToDateWhen. Then we are ready to land this change. 
Thanks! I was too busy to check this PR earlier. I‚Äôve fixed the issues now ‚Äî appreciate the review!
"Note ""beta"" was updated to 3.39; previous cherry pick was to 3.38 which was promoted to stable."
"The `FlutterViewController` API looks good to me üëç 

The iOS embedder implementation looks reasonable to me, however, please also get a review from someone that better understands the iOS embedder.

> Note that this feature will NOT work if the the embedded app is wrapped in flexible or unsized widgets, such as Scaffold.

Pedantic nitpick (sorry üòÇ): this feature doesn't work if the top-level widget does not support unbounded constraints, for example if it doesn't properly implement the intrinsic protocol. Many ""flexible"" or ""unsized"" widgets do work as expected, though. See this comment for details: https://github.com/flutter/flutter/issues/137875#issuecomment-1839697987

> The FlutterView will just not display at all.

Do you get an error at least? What's the error? Where do you see it? If no error, would it be possible to fix that?"
Please also add unit tests!
"This makes uploaded bits smaller, right? By how much?
Have we confirmed on older Chrome builds? When was this fixed?"
"> This makes uploaded bits smaller, right? By how much?

Yes, added the numbers to the PR description. It's ¬±100KB smaller.

> Have we confirmed on older Chrome builds? When was this fixed?

This PR is a no-op for apps (other than making CanvasKit's size smaller). The web engine has been using the browser `ImageDecoder` exclusively on Chrome for quite a while now. There was one remaining edge case that required Skia decoders, but that was addressed in https://github.com/flutter/engine/pull/53201 more than a year ago.

TL;DR: Flutter web apps today in Chrome are already not using the Skia decoders. This PR is removing the unused decoders to save size."
This is still a WIP as I am not able to create a reduced test case for the regression spotted in the linked issue using just the DisplayList layer. Pushing this speculative fix to test against existing goldens while I work on reasoning about the report.
"> Flags that have no real need to be set statically in production apps (like --trace-skia) are now only settable via the command line.

Was that a requirement?  It seems like there may be a valid case where someone would want to use a 3rd party profiler that launches an app itself, outside of flutters command-line tool.  I don't think perfetto works that way, you have to launch yourself.  RenderDoc works that way for gpu frame debugging."
"> > Flags that have no real need to be set statically in production apps (like --trace-skia) are now only settable via the command line.
> 
> Was that a requirement? It seems like there may be a valid case where someone would want to use a 3rd party profiler that launches an app itself, outside of flutters command-line tool. I don't think perfetto works that way, you have to launch yourself. RenderDoc works that way for gpu frame debugging.

Oh interesting case....no this isn't a requirement :) We could make all command line flags settable via the manifest. I just assumed that wouldn't be applicable for some flags."
/gemini review
Commit queue failed; closing this roll.
" @jtmcdole please fill out the PR description above, afterwards the release team will review this request."
@camsim99 - no rush on this; only needs to land before other CP can be tested.
cc @rkishan516
"> @flutter-zl i don't have access to approve, and i definitely would love to have it merged soon, like i said i just wonder if you would consider changing the code so that if the user puts `?flutter-semantics=false `that it would be false - since querystring is key value pairs this could be confusing checking _only_ for the key
> 
> but i'd rather ""skip"" my suggestion than delay it much :)

It is a great suggestion. I updated the code accordingly."
"Awesome thanks!


Get Outlook for Mac <https://aka.ms/GetOutlookForMac>

From: zhongliugo ***@***.***>
Date: Wednesday, November 12, 2025 at 11:41‚ÄØAM
To: flutter/flutter ***@***.***>
Cc: Warner, Neil ***@***.***>, Comment ***@***.***>
Subject: Re: [flutter/flutter] [web] Enable semantics via query parameter for automation testing (PR #178224)

This Message Is From an External Sender
This message came from outside your organization.

[https://avatars.githubusercontent.com/u/205370234?s=20&v=4]flutter-zl left a comment (flutter/flutter#178224)<https://urldefense.com/v3/__https://github.com/flutter/flutter/pull/178224*issuecomment-3523124024__;Iw!!Nkc5UzxO!pOCnk4RHllxTq-ZNYjEO6BqLffoW7lRNDCxG9W0AW5RLJqLZA_m7ljFFawB6pNVFzq5aSU4uuFdljCfHyB73v9VMAg$>

@flutter-zl<https://urldefense.com/v3/__https://github.com/flutter-zl__;!!Nkc5UzxO!pOCnk4RHllxTq-ZNYjEO6BqLffoW7lRNDCxG9W0AW5RLJqLZA_m7ljFFawB6pNVFzq5aSU4uuFdljCfHyB50_k9AYg$> i don't have access to approve, and i definitely would love to have it merged soon, like i said i just wonder if you would consider changing the code so that if the user puts ?flutter-semantics=false that it would be false - since querystring is key value pairs this could be confusing checking only for the key

but i'd rather ""skip"" my suggestion than delay it much :)

It is a great suggestion. I updated the code accordingly.

‚Äî
Reply to this email directly, view it on GitHub<https://urldefense.com/v3/__https://github.com/flutter/flutter/pull/178224*issuecomment-3523124024__;Iw!!Nkc5UzxO!pOCnk4RHllxTq-ZNYjEO6BqLffoW7lRNDCxG9W0AW5RLJqLZA_m7ljFFawB6pNVFzq5aSU4uuFdljCfHyB73v9VMAg$>, or unsubscribe<https://urldefense.com/v3/__https://github.com/notifications/unsubscribe-auth/BXINOATRQ27DJSIQAJTHB7T34NWL3AVCNFSM6AAAAACLT57ZGOVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZTKMRTGEZDIMBSGQ__;!!Nkc5UzxO!pOCnk4RHllxTq-ZNYjEO6BqLffoW7lRNDCxG9W0AW5RLJqLZA_m7ljFFawB6pNVFzq5aSU4uuFdljCfHyB4PFKHPsw$>.
You are receiving this because you commented.

CONFIDENTIALITY NOTICE: This e-mail communication and any attachments may contain proprietary and privileged information for the use of the designated recipients named above. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply e-mail and destroy all copies of the original message.
"
"Hi @chunhtai! üëã

Thank you for the detailed feedback! I've addressed all your points:

## ‚úÖ Feedback Addressed

### 1. **Dartpad Tool Added**
- Replaced `{@tool snippet}` with `{@tool dartpad}` for highContrastTheme
- Example now points to `examples/api/lib/material/app/high_contrast_override.0.dart`
- Ready for DartPad integration as requested

### 2. **Working Test Included**
- Added comprehensive test at `examples/api/test/material/app/high_contrast_override.0_test.dart`
- Test passes successfully ‚úÖ
- Covers MediaQuery override functionality and UI interaction

### 3. **Proper Documentation Structure**
- Added missing snippet for highContrastDarkTheme with code example
- Consistent documentation format across both parameters
- Clear examples showing MediaQuery override pattern

### 4. **Clean Example Implementation**
- Complete working example demonstrating the MediaQuery approach
- Interactive switch to toggle high contrast override
- Real-time status display showing override effects
- Sample UI elements to visualize theme differences

## üß™ Verification
```bash
flutter test examples/api/test/material/app/high_contrast_override.0_test.dart
# ‚úÖ All tests passed!

flutter analyze packages/flutter/lib/src/material/app.dart --fatal-infos  
# ‚úÖ No issues found!
```

The example is now ready for DartPad integration and provides developers with a clear demonstration of the MediaQuery override pattern you suggested.

Could you please review the updated implementation? I believe it now addresses all the architectural and documentation requirements.

Thank you for your guidance! üôè"
"Thanks for the updates @AnuragTiwari1508, it looks like there is an analysis issue with this PR, and some comments that have not been addressed yet."
"@AnuragTiwari1508 Hi, are you able to take a look at the analysis errors and comments?"
"@dkwingsmt  Thanks for pointing that out! üôå
I‚Äôve already made changes based on the previous feedback. If there are still any issues that persist, please let me know ‚Äî I‚Äôll take a look right away."
"> Thanks for pointing that out! üôå I‚Äôve already made changes based on the previous feedback. If there are still any issues that persist, please let me know ‚Äî I‚Äôll take a look right away.

@AnuragTiwari1508 there are current failures here I think @dkwingsmt was referring to. Can you resolve them?"
"@AnuragTiwari1508 I'm talking about the CI checks Linux analyze failing. 

<img width=""494"" height=""155"" alt=""image"" src=""https://github.com/user-attachments/assets/7692df55-1863-49f9-a088-828b35f2009a"" />


If you keeps clicking into the details you'll find some (typically formatting) error that needs fixing. (Ignore the tree-status one)"
"@dkwingsmt  Thanks, for clarifying! I‚Äôll check the CI logs and fix the formatting or analysis issues as soon as possible."
"@AnuragTiwari1508  Thanks for your contribution! Since I haven't seen updates for a while, I'm going to reluctantly close this pull request for now, but if you get time to address the comments, we'd be more than happy to take a look at a new patch. If you do send a new patch, it would be very useful to reference this one in the description in order to help reviewers see the previous context."
Are you at all worried about the loss of data by throwing the first tool error we see and none of the rest? 
"> Are you at all worried about the loss of data by throwing the first tool error we see and none of the rest?

No, I don't think so. Errors thrown after the initial error are likely due to a cascading failure, and we'd have to explicitly check for multiple reports (possibly with different stack traces) from an individual client within a short timeframe to even identify if multiple exceptions were thrown during a crash."
Commit queue failed; closing this roll.
" @bkonyi please fill out the PR description above, afterwards the release team will review this request."
" @bkonyi please fill out the PR description above, afterwards the release team will review this request."
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"Given that 3.38 is upon us, I don't think we need this anymore."
This is a known issue impacting multiple configurations. Not worth disabling individual shards.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"I am not sure what the implications might be on performance here, have you see the TableView widget that supports cell merging with lazy loading for children?"
"Hey @Piinks, thanks for the fast response to that PR, really appreciate it cuz I thought it would take way longer for someone to take a look, as my other older PR #176393 is still waiting, but maybe that one‚Äôs not very interesting for you guysüòÖüôà

> ...would you be willing to draft an outline of your changes and the motivations behind the decisions you made here?

Sure, I can fill it out but not sure I‚Äôll have time this weekend, but definitely next week I should find a bit of time.

> I am not sure what the implications might be on performance here, have you see the TableView widget that supports cell merging with lazy loading for children?

I'm not sure, but I guess you're referring to the `TableView` from the `two_dimensional_scrollables` package, right? If that's the case, then yes, I know that package. However, I still think there are a few reasons why it makes sense to implement it the way it's done in the PR.
<details>
<summary>Reasons for that PR</summary>

1. **Dependencies:** `two_dimensional_scrollables` is a package on pub.dev and not directly part of Flutter. I think new Flutter devs will expect the `Table` widget to support that out of the box, without needing to search for an extra package. As seen in #21594, a few hundred people gave a thumbs up to that feature, so it seems like expected behavior should be internal. Also, when we compare it to other popular frameworks like MAUI, Ionic, or NativeScript, that kind of functionality is built-in without any extra dependencies.
2. **Complexity:** I think for simple tables, most devs will expect a structure like `Table > TableRow > TableCell`, since that‚Äôs exactly how it works in HTML. In contrast, `TableView` works differently, the `rowBuilder` is separated from the cells, which could makes the widget tree harder to understand. Also, in `TableViewCell`, you have to set both `columnMergeSpan` and `columnMergeStart`. That makes sense when using the builder, but for a simple table, it feels a bit off or unnecessarily complicated. In most other frameworks, and even in standard HTML tables, you just set `colSpan` and `rowSpan` without needing to define a start position.
3. **Built-in RTL:** I'm not 100% sure, but it seems that `TableView.builder` doesn't handle RTL correctly, or at least in my example, switching to RTL still keeps cell 0,0 on the top-left. Btw the existing `Table` widget already supports RTL, and the PR just extends that to also respect it for cell spanning.
4. **TableCellVerticalAlignment**: Also, not 100% sure, but it seems like `verticalAlignment` isn‚Äôt supported in `TableView`. In this PR, `verticalAlignment` still works as expected and it also works correctly with `colSpan` and `rowSpan` for each individual cell.
5. **Performance:** That's a good point you mentioned. For large tables with many offscreen cells that can be lazy-loaded, `TableView.builder` will definitely perform better. But for small tables where all cells are visible, I‚Äôm pretty sure it‚Äôs faster than `TableView`, though I doubt users would notice any difference. Comparing the original `Table` code to my changes, there‚Äôs a minimal impact on performance, but I don‚Äôt think that‚Äôs something end users would feel, especially since the `Table` widget isn‚Äôt designed for massive cell counts anyway. I tested it with 10k cells, and it was about 16ms slower, details are in the ‚ÄúCompare-Performance‚Äù section below. FYI: if performance is your top priority and readability is less important, I could also rewrite [_computeSpanInformation](https://github.com/hm21/flutter/blob/d11f8a4affe098b5d46bd94c0864c93b7ce84e8a/packages/flutter/lib/src/rendering/table.dart#L1247-L1331) to run directly within the same loop in [performLayout](https://github.com/hm21/flutter/blob/d11f8a4affe098b5d46bd94c0864c93b7ce84e8a/packages/flutter/lib/src/rendering/table.dart#L1633). And also the loop inside [table_border.dart](https://github.com/hm21/flutter/blob/d11f8a4affe098b5d46bd94c0864c93b7ce84e8a/packages/flutter/lib/src/rendering/table_border.dart#L288-L398) could I merge.

</details>

<br/>
<details>
<summary>Compare-Performance</summary>

To measure the average render duration, I repeatedly called `setState()` 100 times. 

#### **Test 1: Very Large (10,000 cells: 500 rows √ó 20 columns)**

| Version     | Avg (ms) | Min (ms) | Max (ms) |
|--------------|-----------|-----------|-----------|
| **Original** | 351.09 | 275.40 | 469.32 |
| **PR**       | 367.22 | 289.07 | 452.91 |

---

#### **Test 2: Large (500 cells: 50 rows √ó 10 columns)**

| Version     | Avg (ms) | Min (ms) | Max (ms) |
|--------------|-----------|-----------|-----------|
| **Original** | 42.18 | 20.29 | 96.12 |
| **PR**       | 49.89 | 21.50 | 80.72 |

</details>


Btw, I hope you didn‚Äôt get me wrong `TableView` from `two_dimensional_scrollables` is definitely an awesome package, and I saw in the commits that you‚Äôre also working on it. Still, as I mentioned above, I believe there are valid reasons why it could make sense to support `colSpan`/`rowSpan` in the default `Table` as well. Anyway, if the points I mentioned aren‚Äôt relevant for you and the way to go for devs is to use packages for this kind of core functionality, just let me know, then we can close the PR üòâ But in that case, I‚Äôd also suggest closing #21594 and mentioning that the recommended solution is to use the `two_dimensional_scrollables` package.


Thanks again for the fast response to that PR and I'll fill out the document you mentioned as soon as possible.


"
"> as my other older PR https://github.com/flutter/flutter/pull/176393 is still waiting, but maybe that one‚Äôs not very interesting for you guys

Actually, we use labels to route PRs to the right sub-team for review. I noticed that PR did not have a team label on it, so I applied one and reached out to the team to confirm. I hope you will hear back soon on it, and thanks again for contributing!
We have a Discord channel for reaching out to folks directly if a PR goes unattended, see here for docs:

- https://github.com/flutter/flutter/blob/master/docs/contributing/Tree-hygiene.md#who
- https://github.com/flutter/flutter/blob/master/docs/contributing/Chat.md

Thanks as well for your detailed response. If you are able to fill out the design dic template (the various sections are suggestive, not all required) it would be helpful for review. Otherwise I can start digging into this, it just might take a minute to get through it all. :)
"
"Hey @Piinks, thanks for sharing those two links and my bad for not reading carefully enough that I was supposed to mention the open PR in the Discord channel after two weeksüôà Still, really appreciate your help with tagging the team on the other PR.

The link to the design-document is https://flutter.dev/go/table-cell-span.

Also, sorry again, I missed that the usual process is to first create an issue referencing the design doc before opening a PR. If you'd still prefer I create a new issue for the design doc but I just thought it might be a bit pointless now that the PR is already thereüòÖ"
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
It'll take me some time to review but first I want to say that this is a fascinating change! 
"Gave another round of review. My apology that the review was a bit delayed due to the chaos around the US holiday lately.

"
"@/chunhtai is OOO until the end of the month, so we'll probably have to wait for him for further progress. Meanwhile I'll see if there's anything I can do."
Hi! @O-Hannonen  Are you able to address the comments above so we can work together to get this landed? This is a great addition and I'm looking forward to it!
"Sorry for the delay due to holidays. @dkwingsmt fixed the other issues but the one regarding the constructors, as there were conflicting requests from reviewers."
"Looking back to UIKit's API,

<img width=""720"" height=""363"" alt=""image"" src=""https://github.com/user-attachments/assets/6c2935be-43bd-4b47-8e94-0f072d4deab8"" />

I think we might as well adopt the good old `with`. Namely,
```dart
CupertinoFocusHalo.withRect()
CupertinoFocusHalo.withRRect()
```

Derivatively, we'll have the following in the future:
```dart
CupertinoFocusHalo.withRSuperellipse()
CupertinoFocusHalo.withShape()
```

What do you think? 

cc @justinmc "
Also there are some format failures. Not sure if there are more beyond them.
I like the `with` naming! Might as well be consistent with UIKit.
Also there are analyzer issues.
"I've tried for a while and it seems that focus can not be nested. When `.focusable` views are nested, only the outmost one can be focused and display the focus ring.

In this way we have 3 options to deal with it:
1. Only the outmost focus halo can display, just like iOS.
2. All nested focus halo can display, which is the simplest.
3. Only the innermost focus halo can display, since it's the primary focus.

Although I have my own preference, option 2 is definitely acceptable. Let's keep the current way for now."
"I can run the example files. Not sure why it didn't work for you.
<img width=""619"" height=""579"" alt=""image"" src=""https://github.com/user-attachments/assets/1b4203f8-6bc2-4d61-99ca-ce4c35b7f6ba"" />


Also analyzer issues:
```
packages/flutter/lib/src/cupertino/cupertino_focus_halo.dart:29:21: Missing type annotation (expression) (always_specify_types)
packages/flutter/lib/src/cupertino/cupertino_focus_halo.dart:30:36: Use 'const' with the constructor to improve performance (expression) (prefer_const_constructors)
packages/flutter/lib/src/cupertino/cupertino_focus_halo.dart:31:36: Use 'const' with the constructor to improve performance (expression) (prefer_const_constructors)
packages/flutter/lib/src/cupertino/cupertino_focus_halo.dart:48:21: Missing type annotation (expression) (always_specify_types)
packages/flutter/lib/src/cupertino/cupertino_focus_halo.dart:49:36: Use 'const' with the constructor to improve performance (expression) (prefer_const_constructors)
packages/flutter/lib/src/cupertino/cupertino_focus_halo.dart:50:36: Use 'const' with the constructor to improve performance (expression) (prefer_const_constructors)
```"
"There's a real test failure.
<details>

```

01:26 +1377 ~7: /b/s/w/ir/x/w/flutter/packages/flutter/test/cupertino/action_sheet_test.dart: Action sheet semantics
‚ïê‚ïê‚ï° EXCEPTION CAUGHT BY FLUTTER TEST FRAMEWORK ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
The following TestFailure was thrown running a test:
Expected: semantics node matching:
          TestSemantics(
            id: 0,
            rect: Rect.fromLTRB(0.0, 0.0, 2400.0, 1800.0),
            children: <TestSemantics>[
              TestSemantics(
                children: <TestSemantics>[
                  TestSemantics(
                    children: <TestSemantics>[
                      TestSemantics(
                        flags: <SemanticsFlag>[SemanticsFlag.scopesRoute, SemanticsFlag.namesRoute],
                        label: 'Alert',
                        children: <TestSemantics>[
                          TestSemantics(
                            flags: <SemanticsFlag>[SemanticsFlag.hasImplicitScrolling],
                            children: <TestSemantics>[
                              TestSemantics(
                                label: 'The title',
                                children: <TestSemantics>[
                                ],
                              ),
                              TestSemantics(
                                label: 'The message',
                                children: <TestSemantics>[
                                ],
                              ),
                            ],
                          ),
                          TestSemantics(
                            flags: <SemanticsFlag>[SemanticsFlag.hasImplicitScrolling],
                            children: <TestSemantics>[
                              TestSemantics(
                                flags: <SemanticsFlag>[SemanticsFlag.isButton],
                                actions: <SemanticsAction>[SemanticsAction.tap],
                                label: 'One',
                                children: <TestSemantics>[
                                ],
                              ),
                              TestSemantics(
                                flags: <SemanticsFlag>[SemanticsFlag.isButton],
                                actions: <SemanticsAction>[SemanticsAction.tap],
                                label: 'Two',
                                children: <TestSemantics>[
                                ],
                              ),
                            ],
                          ),
                          TestSemantics(
                            flags: <SemanticsFlag>[SemanticsFlag.isButton],
                            actions: <SemanticsAction>[SemanticsAction.tap],
                            label: 'Cancel',
                            children: <TestSemantics>[
                            ],
                          ),
                        ],
                      ),
                    ],
                  ),
                ],
              ),
            ],
          )
  Actual: SemanticsTester:<SemanticsTester for SemanticsNode#0(Rect.fromLTRB(0.0, 0.0, 2400.0,
1800.0))>
   Which: expected node id null to have flags [SemanticsFlag.isButton] but found flags 2097160.
          Current SemanticsNode tree:
            SemanticsNode#0
             ‚îÇ Rect.fromLTRB(0.0, 0.0, 2400.0, 1800.0)
             ‚îÇ
             ‚îî‚îÄSemanticsNode#1
               ‚îÇ Rect.fromLTRB(0.0, 0.0, 800.0, 600.0) scaled by 3.0x
               ‚îÇ textDirection: ltr
               ‚îÇ
               ‚îî‚îÄSemanticsNode#5
                 ‚îÇ Rect.fromLTRB(0.0, 0.0, 800.0, 600.0)
                 ‚îÇ sortKey: OrdinalSortKey#b1e00(order: 0.0)
                 ‚îÇ
                 ‚îî‚îÄSemanticsNode#6
                   ‚îÇ Rect.fromLTRB(100.0, 346.9, 700.0, 592.0)
                   ‚îÇ flags: scopesRoute, namesRoute
                   ‚îÇ label: ""Alert""
                   ‚îÇ textDirection: ltr
                   ‚îÇ role: dialog
                   ‚îÇ
                   ‚îú‚îÄSemanticsNode#7
                   ‚îÇ ‚îÇ Rect.fromLTRB(8.0, 8.0, 592.0, 65.0)
                   ‚îÇ ‚îÇ flags: hasImplicitScrolling
                   ‚îÇ ‚îÇ scrollExtentMin: 0.0
                   ‚îÇ ‚îÇ scrollPosition: 0.0
                   ‚îÇ ‚îÇ scrollExtentMax: 0.0
                   ‚îÇ ‚îÇ
                   ‚îÇ ‚îú‚îÄSemanticsNode#8
                   ‚îÇ ‚îÇ   Rect.fromLTRB(16.0, 13.5, 568.0, 26.5)
                   ‚îÇ ‚îÇ   label: ""The title""
                   ‚îÇ ‚îÇ   textDirection: ltr
                   ‚îÇ ‚îÇ
                   ‚îÇ ‚îî‚îÄSemanticsNode#9
                   ‚îÇ     Rect.fromLTRB(16.0, 30.5, 568.0, 43.5)
                   ‚îÇ     label: ""The message""
                   ‚îÇ     textDirection: ltr
                   ‚îÇ
                   ‚îú‚îÄSemanticsNode#10
                   ‚îÇ ‚îÇ Rect.fromLTRB(8.0, 65.3, 592.0, 179.9)
                   ‚îÇ ‚îÇ flags: hasImplicitScrolling
                   ‚îÇ ‚îÇ scrollExtentMin: 0.0
                   ‚îÇ ‚îÇ scrollPosition: 0.0
                   ‚îÇ ‚îÇ scrollExtentMax: 0.0
                   ‚îÇ ‚îÇ
                   ‚îÇ ‚îú‚îÄSemanticsNode#11
                   ‚îÇ ‚îÇ   Rect.fromLTRB(0.0, 0.0, 584.0, 57.2)
                   ‚îÇ ‚îÇ   actions: focus, tap
                   ‚îÇ ‚îÇ   flags: isButton, isFocusable
                   ‚îÇ ‚îÇ   label: ""One""
                   ‚îÇ ‚îÇ   textDirection: ltr
                   ‚îÇ ‚îÇ
                   ‚îÇ ‚îî‚îÄSemanticsNode#12
                   ‚îÇ     Rect.fromLTRB(0.0, 57.5, 584.0, 114.6)
                   ‚îÇ     actions: focus, tap
                   ‚îÇ     flags: isButton, isFocusable
                   ‚îÇ     label: ""Two""
                   ‚îÇ     textDirection: ltr
                   ‚îÇ
                   ‚îî‚îÄSemanticsNode#13
                       Rect.fromLTRB(8.0, 187.9, 592.0, 245.1)
                       actions: focus, tap
                       flags: isButton, isFocusable
                       label: ""Cancel""
                       textDirection: ltr
          The semantics tree would have matched the following configuration:
            TestSemantics.root(
              children: <TestSemantics>[
                TestSemantics(
                  id: 1,
                  textDirection: TextDirection.ltr,
                  children: <TestSemantics>[
                    TestSemantics(
                      id: 5,
                      children: <TestSemantics>[
                        TestSemantics(
                          id: 6,
                          flags: <SemanticsFlag>[SemanticsFlag.scopesRoute,
SemanticsFlag.namesRoute],
                          label: 'Alert',
                          textDirection: TextDirection.ltr,
                          role: SemanticsRole.dialog,
                          children: <TestSemantics>[
                            TestSemantics(
                              id: 7,
                              flags: <SemanticsFlag>[SemanticsFlag.hasImplicitScrolling],
                              children: <TestSemantics>[
                                TestSemantics(
                                  id: 8,
                                  label: 'The title',
                                  textDirection: TextDirection.ltr,
                                ),
                                TestSemantics(
                                  id: 9,
                                  label: 'The message',
                                  textDirection: TextDirection.ltr,
                                ),
                              ],
                            ),
                            TestSemantics(
                              id: 10,
                              flags: <SemanticsFlag>[SemanticsFlag.hasImplicitScrolling],
                              children: <TestSemantics>[
                                TestSemantics(
                                  id: 11,
                                  flags: <SemanticsFlag>[SemanticsFlag.isButton,
SemanticsFlag.isFocusable],
                                  actions: <SemanticsAction>[SemanticsAction.tap,
SemanticsAction.focus],
                                  label: 'One',
                                  textDirection: TextDirection.ltr,
                                ),
                                TestSemantics(
                                  id: 12,
                                  flags: <SemanticsFlag>[SemanticsFlag.isButton,
SemanticsFlag.isFocusable],
                                  actions: <SemanticsAction>[SemanticsAction.tap,
SemanticsAction.focus],
                                  label: 'Two',
                                  textDirection: TextDirection.ltr,
                                ),
                              ],
                            ),
                            TestSemantics(
                              id: 13,
                              flags: <SemanticsFlag>[SemanticsFlag.isButton,
SemanticsFlag.isFocusable],
                              actions: <SemanticsAction>[SemanticsAction.tap,
SemanticsAction.focus],
                              label: 'Cancel',
                              textDirection: TextDirection.ltr,
                            ),
                          ],
                        ),
                      ],
                    ),
                  ],
                ),
              ],
            )

When the exception was thrown, this was the stack:
#4      main.<anonymous closure> (file:///b/s/w/ir/x/w/flutter/packages/flutter/test/cupertino/action_sheet_test.dart:1751:5)
<asynchronous suspension>
#5      testWidgets.<anonymous closure>.<anonymous closure> (package:flutter_test/src/widget_tester.dart:192:15)
<asynchronous suspension>
#6      TestWidgetsFlutterBinding._runTestBody (package:flutter_test/src/binding.dart:1059:5)
<asynchronous suspension>
<asynchronous suspension>
(elided one frame from package:stack_trace)

This was caught by the test expectation on the following line:
  file:///b/s/w/ir/x/w/flutter/packages/flutter/test/cupertino/action_sheet_test.dart line 1751
The test description was:
  Action sheet semantics
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
01:26 +1377 ~7 -1: /b/s/w/ir/x/w/flutter/packages/flutter/test/cupertino/route_test.dart: showCupertinoModalPopup barrier dismissible
01:26 +1377 ~7 -1: /b/s/w/ir/x/w/flutter/packages/flutter/test/cupertino/action_sheet_test.dart: Action sheet semantics [E]
  Test failed. See exception logs above.
  The test description was: Action sheet semantics
```

</details>

I think it's just adding `isFocusable` to respective nodes. "
@O-Hannonen Can you take a look at the test failure? We're really close to merging this PR. Thank you very much!
"@dkwingsmt sorry for the delay, has been super busy few weeks. The failing test is now fixed!"
"The test failures seem real and only occur on Web.
```
01:01 +491 ~13: test/cupertino/action_sheet_test.dart: CupertinoActionSheetActions in CupertinoActionSheet can be traversed with keyboard
‚ïê‚ïê‚ï° EXCEPTION CAUGHT BY FLUTTER TEST FRAMEWORK ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
The following TestFailure was thrown running a test:
Expected: true
  Actual: <false>

When the exception was thrown, this was the stack:
at module0.Error._throwWithCurrentStackTrace (http://localhost:38209/material/main.dart.wasm:wasm-function[853]:0x37bd3b)
    at module0.fail (http://localhost:38209/material/main.dart.wasm:wasm-function[10125]:0x428142)
    at module0._expect (http://localhost:38209/material/main.dart.wasm:wasm-function[10111]:0x427e91)
    at module0.expect (http://localhost:38209/material/main.dart.wasm:wasm-function[10110]:0x427c26)
    at module0.expect (http://localhost:38209/material/main.dart.wasm:wasm-function[10107]:0x427abb)
    at module0.main closure at org-dartlang-app:///cupertino/action_sheet_test.dart:2184:5 inner (http://localhost:38209/material/main.dart.wasm:wasm-function[78817]:0xa1dd44)
    at module0._awaitHelper closure at org-dartlang-sdk:///dart-sdk/lib/_internal/wasm/lib/async_patch.dart:104:5 (http://localhost:38209/material/main.dart.wasm:wasm-function[6348]:0x3dc17c)
    at module0.closure wrapper at org-dartlang-sdk:///dart-sdk/lib/_internal/wasm/lib/async_patch.dart:104:5 trampoline (http://localhost:38209/material/main.dart.wasm:wasm-function[6351]:0x3dc1fe)

The test description was:
  CupertinoActionSheetActions in CupertinoActionSheet can be traversed with keyboard
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
01:01 +491 ~13 -1: test/cupertino/action_sheet_test.dart: CupertinoActionSheetActions in CupertinoActionSheet can be traversed with keyboard [E]
  Test failed. See exception logs above.
  The test description was: CupertinoActionSheetActions in CupertinoActionSheet can be traversed with keyboard
  
01:01 +491 ~13 -1: test/cupertino/action_sheet_test.dart: CupertinoActionSheetAction in CupertinoActionSheet actions can be selected with keyboard
‚ïê‚ïê‚ï° EXCEPTION CAUGHT BY FLUTTER TEST FRAMEWORK ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
The following TestFailure was thrown running a test:
Expected: true
  Actual: <false>

When the exception was thrown, this was the stack:
at module0.Error._throwWithCurrentStackTrace (http://localhost:38209/material/main.dart.wasm:wasm-function[853]:0x37bd3b)
    at module0.fail (http://localhost:38209/material/main.dart.wasm:wasm-function[10125]:0x428142)
    at module0._expect (http://localhost:38209/material/main.dart.wasm:wasm-function[10111]:0x427e91)
    at module0.expect (http://localhost:38209/material/main.dart.wasm:wasm-function[10110]:0x427c26)
    at module0.expect (http://localhost:38209/material/main.dart.wasm:wasm-function[10107]:0x427abb)
    at module0.main closure at org-dartlang-app:///cupertino/action_sheet_test.dart:2253:5 inner (http://localhost:38209/material/main.dart.wasm:wasm-function[78810]:0xa1d80b)
    at module0._awaitHelper closure at org-dartlang-sdk:///dart-sdk/lib/_internal/wasm/lib/async_patch.dart:104:5 (http://localhost:38209/material/main.dart.wasm:wasm-function[6348]:0x3dc17c)
    at module0.closure wrapper at org-dartlang-sdk:///dart-sdk/lib/_internal/wasm/lib/async_patch.dart:104:5 trampoline (http://localhost:38209/material/main.dart.wasm:wasm-function[6351]:0x3dc1fe)

The test description was:
  CupertinoActionSheetAction in CupertinoActionSheet actions can be selected with keyboard
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
01:01 +491 ~13 -2: test/cupertino/action_sheet_test.dart: CupertinoActionSheetAction in CupertinoActionSheet actions can be selected with keyboard [E]
  Test failed. See exception logs above.
  The test description was: CupertinoActionSheetAction in CupertinoActionSheet actions can be selected with keyboard
  
01:01 +491 ~13 -2: test/cupertino/action_sheet_test.dart: CupertinoActionSheetAction as CupertinoActionSheet cancel button can be selected with keyboard
‚ïê‚ïê‚ï° EXCEPTION CAUGHT BY FLUTTER TEST FRAMEWORK ‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
The following TestFailure was thrown running a test:
Expected: true
  Actual: <false>

When the exception was thrown, this was the stack:
at module0.Error._throwWithCurrentStackTrace (http://localhost:38209/material/main.dart.wasm:wasm-function[853]:0x37bd3b)
    at module0.fail (http://localhost:38209/material/main.dart.wasm:wasm-function[10125]:0x428142)
    at module0._expect (http://localhost:38209/material/main.dart.wasm:wasm-function[10111]:0x427e91)
    at module0.expect (http://localhost:38209/material/main.dart.wasm:wasm-function[10110]:0x427c26)
    at module0.expect (http://localhost:38209/material/main.dart.wasm:wasm-function[10107]:0x427abb)
    at module0.main closure at org-dartlang-app:///cupertino/action_sheet_test.dart:2294:5 inner (http://localhost:38209/material/main.dart.wasm:wasm-function[78803]:0xa1d33e)
    at module0._awaitHelper closure at org-dartlang-sdk:///dart-sdk/lib/_internal/wasm/lib/async_patch.dart:104:5 (http://localhost:38209/material/main.dart.wasm:wasm-function[6348]:0x3dc17c)
    at module0.closure wrapper at org-dartlang-sdk:///dart-sdk/lib/_internal/wasm/lib/async_patch.dart:104:5 trampoline (http://localhost:38209/material/main.dart.wasm:wasm-function[6351]:0x3dc1fe)

The test description was:
  CupertinoActionSheetAction as CupertinoActionSheet cancel button can be selected with keyboard
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
01:01 +491 ~13 -3: test/cupertino/action_sheet_test.dart: CupertinoActionSheetAction as CupertinoActionSheet cancel button can be selected with keyboard [E]
  Test failed. See exception logs above.
  The test description was: CupertinoActionSheetAction as CupertinoActionSheet cancel button can be selected with keyboard
```"
@dkwingsmt seems that the arrow up / arrow down traversal is not supported on web. Changed to tabs which should work on all platforms
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"You've included some unwanted files.

I don't think it's okay to add terminal output colors to assert messages."
@justinmc @Albert221  The changes are now ready for review. I‚Äôd greatly appreciate your feedback.
"> I wonder why _pressedKeys has anything in it during hot reload? Maybe we need to clear it out at some point instead? Just thinking through an alternative. @dkwingsmt.

I would have been able to answer this question years ago when I was active on this problem. There was a lot of nuances and synchronization issues that I don't trust myself to give an accurate answer now. The most reliable way IMO is to actually verify if it fixed the problem in the target issue."
"> Sorry for the late review!
> 
> It definitely looks like a reasonable change, although can you confirm if you have verified that it actually fixes the problem in #172153 ?
> 
> Also have you attempted to write a test for it?

Yes tested and it fixes the issue."
"@justinmc I've added test, but it seems like it is hard for me to know why some unrelated test fail as I do not have access to the tool mentioned in docs, may you kindly advise? "
@richard457 What tool don't you have access to? It should be possible for you to see the failing test's error message and to run it locally and reproduce the failure. Looks like it is a keyboard test that's failing.
Hey @richard457  does this documentation on seeing test results help? https://github.com/flutter/flutter/blob/master/docs/contributing/testing/Fix-failing-checks.md
"> Hey @richard457 does this documentation on seeing test results help? [`master`/docs/contributing/testing/Fix-failing-checks.md](https://github.com/flutter/flutter/blob/master/docs/contributing/testing/Fix-failing-checks.md?rgh-link-date=2025-11-11T23%3A11%3A31Z)

Thank you very much this is what I was missing, I am sorry,  I am new to the codebase and would like to ask a quick question which branch should I base on most recommended?"
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"> Sorry for the late reply! I tried the change in carousel.0.dart but seems when we set infinite: true, CarouselView.weighted() will throw error and the carousel items cannot show up correctly. Could you double check whether the behavior is working?

Let me take a look at it, I will also update test to capture this case.
"
"> Let me take a look at it, I will also update test to capture this case.

Sounds good! Let me know whenever it's ready to review:)"
"> Sounds good! Let me know whenever it's ready to review:)
Hey, @QuncCccccc, I have pushed the changes, you can review."
Commit queue failed; closing this roll.
Is this PR ready for another round of review? (from triage)
"> Is this PR ready for another round of review? (from triage)

Yes @dkwingsmt."
Is this PR still being worked on? (from triage)
"> Is this PR still being worked on? (from triage)

Yes, its ready for review."
"Hi @flutter-zl, can you take a secondary review since this also touch some of the web engine code?

Also looks like this pr may need a rebase, the ci seems to act weird "
LGTM.
"@chunhtai I don't know why tests are failing, can you please have a look ?"
"looks like the ci was not working correctly, can you rebase and try again?"
"> looks like the ci was not working correctly, can you rebase and try again?

No, I still see the same issue.
"
"looks like there are some lint errors
```
‚ùå Failures for clang-tidy on /b/s/w/ir/cache/builder/engine/src/flutter/lib/ui/semantics/semantics_update_builder.cc:
/b/s/w/ir/cache/builder/engine/src/flutter/lib/ui/semantics/semantics_update_builder.cc:95:19: error: parameter 'minValue' is passed by value and only copied once; consider moving it to avoid unnecessary copies [performance-unnecessary-value-param,-warnings-as-errors]
   95 |   node.minValue = minValue;
      |                   ^       
      |                   std::move( )
/b/s/w/ir/cache/builder/engine/src/flutter/lib/ui/semantics/semantics_update_builder.cc:96:19: error: parameter 'maxValue' is passed by value and only copied once; consider moving it to avoid unnecessary copies [performance-unnecessary-value-param,-warnings-as-errors]
   96 |   node.maxValue = maxValue;
      |                   ^       
      |                   std::move( )
Suppressed 4419 warnings (4359 in non-user code, 60 NOLINT).
Use -header-filter=.* to display errors from all non-system headers. Use -system-headers to display errors from system headers as well.
```"
"looks like the engine unit test hangs for some reason
https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8711037883272831009/+/u/test:_test:_Host_Tests_for_host_debug_unopt/stdout

Can you try to reproduce locally to see what may have cause this?

you can follow this guide to compile engine https://github.com/flutter/flutter/blob/master/engine/src/flutter/docs/contributing/Compiling-the-engine.md"
"> Can you try to reproduce locally to see what may have cause this?

Sure checking.

Edit:- Its working on my local without any issue."
Seems like there are a bunch of conflicts.
"looks like this integration test is failing
LocalizationInitializationTest testNoLocalePrepend]

https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8707260778880016257/+/u/test:_Scenario_App_Integration_Tests/stdout"
"@chunhtai I checked the tests, but couldn't figure out issue. Can you please help me with this?"
"Hey @rkishan516 it looks like you made some updates here, but there are some failing tests. Do you plan to continue with this change?"
"> Hey @rkishan516 it looks like you made some updates here, but there are some failing tests. Do you plan to continue with this change?

Yes, this is around the corner for landing, just few tests are failing. Will give a try over weekend."
"@chunhtai, @hannah-hyj can you do a last review? all tests are fixed now."
Gentle nudge @chunhtai (from triage)
"the google test is a valid failure, but the actual bug is in tab widget. will have to fix it before merging this

i will put up a pr to fix the tab first, then we can merge this pr after that"
"It looks like there are some merge conflicts here, but once those are sorted I think the blocking issue has been resolved here."
"Reason for revert: The PR did not finish ""Google Testing"", and actually caused several failures in Google"
"@rkishan516 please do not manually put PRs in the queue, the `autosubmit` label should be used. We have to revert this for failing tests that did not complete before it was put in the queue."
"> @rkishan516 please do not manually put PRs in the queue, the autosubmit label should be used. We have to revert this for failing tests that did not complete before it was put in the queue.

Sure, I will keep in mind."
We should make sure we are very certain that we want to support this use case before we add something like this due to the ability to shoot yourself in the foot here. @loic-sharma do you know if this is a valid concern for multiwindow/desktop apps?
"> @loic-sharma do you know if this is a valid concern for multiwindow/desktop apps?

I don't know, however, I suspect that there's a better fix for https://github.com/flutter/flutter/issues/133533.

@chinmaygarde Would you have any thoughts on this change for this use case:

> Some desktop applications, such as games or apps with animation-driven audio (e.g., Rive) rely on continuous frame rendering to maintain smooth animation timing and audio playback.
> The current lifecycle behavior stops scheduling frames when the app is hidden or paused (e.g., mission control on MacOS), which can interrupt these use cases.
"
"The fix was not originally made for this specific issue, but to address a problem we‚Äôre facing in our app. We are building a Desktop game, and when the window is completely covered, frame rendering stops, which prevents our animations from running.

To work around this, we currently have to intercept the hidden state and replace it with inactive, which is really hacky. The key requirement for us is to keep animations running even when the window is not visible.

I‚Äôm open to different approaches to achieve this, as long as we can meet that requirement."
@tguerin Can you explain why you'd like the animation to keep running at background? What is broken by missing these animation frames? It would be great if you can open a new issue for this so we can discuss it and track it more clearly.
Here is the issue https://github.com/flutter/flutter/issues/174356
Does this comment in the linked issue provide what is needed here? https://github.com/flutter/flutter/issues/174356#issuecomment-3287185284
I will rework the PR to include the suggested approach.
"@loic-sharma I managed to find some time to implement the suggested changes. However I still have one failing test, seems that the rendering_tester used by the linux_customer_testing still uses the version that doesn't have my modifications. How can i fix this? Is there some kind of dependency to bump?"
"> However I still have one failing test, seems that the rendering_tester used by the linux_customer_testing still uses the version that doesn't have my modifications. How can i fix this? Is there some kind of dependency to bump?

This means that as it currently stands, this is a breaking change. Our policy is documented here: https://github.com/flutter/flutter/blob/master/docs/contributing/Tree-hygiene.md#handling-breaking-changes
"
"@tguerin That test failed because DevTools has a class that implements `Ticker`. We either need to update this class to add the new `forceFrames` member you added, or we need to remove this class (it appears to be unused code). I sent a PR to remove the class: https://github.com/flutter/devtools/pull/9459. Once that lands, it should unblock this PR."
"The customer testing is still failing, do i need to wait a release of the dev tools?"
"@tguerin Ah sorry, it looks like I have to roll DevTools into customer tests, and then roll customer tests into Flutter. Apologies for the delay, this is my first time doing this process.

I've started the DevTools to customer tests roll here: https://github.com/flutter/tests/pull/473"
@tguerin Customer tests should be rolled now (https://github.com/flutter/flutter/pull/177409). Could you rebase? I think this should be unblocked now.
This is looking really good! Thanks for the wonderful contribution :)
@tguerin Thanks for addressing all the feedback! It looks like you'll need to run `dart format` to pass the `Linux analyze` check.
"> @tguerin Thanks for addressing all the feedback! It looks like you'll need to run `dart format` to pass the `Linux analyze` check.

Yes, normally my ide auto-format on save but didn't do it for this file. All good now."
"> This is looking really good! Thanks for the wonderful contribution :)

Thank you for helping me land my first PR, really appreciate."
"@loic-sharma @justinmc Thanks for all the discussion, this approach is definitely much cleaner than the first one I implemented, and it was interesting to dive into the Ticker code.

I‚Äôll make sure to be more thorough next time to avoid some of the oversights in this PR. I was on holiday and trying to squeeze in time to address feedback, which led to a few things slipping through that I'd normally catch. Really appreciate everyone's patience and reviews!"
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"hi @ahmedsameha1 , can you resolve the merge conflicts so this PR can be landed? Thanks!"
@bkonyi Friendly ping :)
stuck in the queue; re-inserting
"Ready for re-review.

FYI, the Linux tests are currently failing, but currently I don't think my changes are related. I quickly checked a few other new PRs and saw that the Linux tests failed for them as well. However, please let me know if you think my changes are the problem. I will look into it further.
"
"Looks good to me! Thanks @hm21!

I think we're experiencing some infrastructure issues, so I don't think any of those Linux failures are the result of your change."
"Okay `targetPlatform` is now required, so it‚Äôs ready for review. I think the PR is complete now, but if you have any other suggestions or ideas to extend it before merging, let me know. Thanks again for your reviews."
"An existing Git SHA, `414d66bf4f353eea6e98e0c0d70a2db9bea9b9fc`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"An existing Git SHA, `414d66bf4f353eea6e98e0c0d70a2db9bea9b9fc`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
I just fixed the Google Testing for this PR. Good to be submitted now. @bkonyi do you want to take a final look at it before adding the autosubmit tag?
"> I just fixed the Google Testing for this PR. Good to be submitted now. @bkonyi do you want to take a final look at it before adding the autosubmit tag?

Thanks! I was going to take a look at that today :) I've approved the G3Fix and this change LGTM.

We should look into adding this feature to our documentation (filed https://github.com/flutter/flutter/issues/178294).

Thanks for your contribution @hm21!"
"Awesome that the PR is now ready to merge. Thanks @bkonyi and @chingjun for reviewing it, which helped improve the code quality!
If there are any questions regarding the documentation, feel free to tag me."
Commit queue failed; closing this roll.
"Hi @jtmcdole, I suspect that this change requires me to update tests in the below files. Let me know if I need to change it or make any other changes.

- [dev/snippets/test/snippets_test.dart](https://github.com/flutter/flutter/blob/master/dev/snippets/test/snippets_test.dart)
- [dev/snippets/test/snippet_parser_test.dart](https://github.com/flutter/flutter/blob/master/dev/snippets/test/snippet_parser_test.dart)
"
"@safwenbarhoumi Can you link the issue that this fixes? Sorry if I just missed it.

"
"> @safwenbarhoumi Can you link the issue that this fixes? Sorry if I just missed it.

@safwenbarhoumi you can do this by adding ""Fixes https://github.com/flutter/flutter/issues/177615"" to the PR description. That way, if this PR gets merged, the linked issue gets closed and marked as fixed."
@justinmc  Here is the fixe  https://github.com/flutter/flutter/issues/177615
"It not a problem or an issue it's just an improvment of the output of flutter developer because maybe it was not clear especially for flutter beginners
"
"@safwenbarhoumi it looks like there are currently a couple of issues with this PR. The PR template has not been filled out completely, the CLA needs to be signed and there are currently analysis failures that need to be resolved. Can you take a look?"
@prash4931 you do not need to merge or rebase every time something is pushed to master.
"> @prash4931 you do not need to merge or rebase every time something is pushed to master.

Noted"
@tirth-patel-nc  test cases already exist for this example at flutter/examples/api/test/widgets/routes/route_observer.0_test.dart. Do I need to add more test cases for this?
"> @tirth-patel-nc test cases already exist for this example at flutter/examples/api/test/widgets/routes/route_observer.0_test.dart. Do I need to add more test cases for this?

yes, as victor mentioned, we‚Äôll need a test for the new change you‚Äôve made. you can prolly add a small overflow test in that same file.

```
expect(tester.takeException(), isNull);
```"
"Hi @victorsanni, @tirth-patel-nc  I've added the required tests. Please check
"
@prash4931 Do you still have plans to finish this PR or should it be closed?
"@prash4931 FYI you have an analyzer failure here, but we'd love to merge this if you have time to update it!"
@victorsanni please review the changes
Hey @prash4931 it looks like this comment needs to be addressed before we can merge this: https://github.com/flutter/flutter/pull/170980#discussion_r2456631595
Hey @nebkat are you planning to return to this change and add tests?
"Thanks for the quick review!

- Addressed feedback: fixed indentation of the block within `showPerformanceOverlay` and removed `const` from `Positioned` (latest commit: b2d1924).
- Behavior unchanged on non‚Äëweb; web path now guards without crashing and reports a clear debug message.

Tests: this change is a web‚Äëonly guard in `WidgetsApp`. Requesting a test exemption; happy to add a small framework test if preferred (e.g., guard that no `PerformanceOverlay` is inserted on web and that a single debug error is reported)."
@jihanurrahman33 Are you still planning to fix the formatting/analyzer problems here?
"Thank you for your contribution. I'm going to close this PR for now since there are outstanding comments, just to get this off our PR review queue. Please don't hesitate to re-open or submit a new PR if you have the time to address the review comments. Thanks!"
"Created cl/803350373 for g3fix, the rest of failures are expected."
"This implementation adds a `Material` to each `ListTile` in a list. I suspect this will be a performance problem, since each `PhysicalShape` pushes a new layer. I don't remember where but I think we rejected a PR or proposal that does exactly this. I might be wrong but I guess that the `Material` widget was designed exactly for this case so that multiple responses can be drawn on the same layer.

Is it possible to keep the current implementation and add some quick check? For example, make `ListTile` check the widgets between itself and its closest `Material`, and warn if there are `Container`s with solid backgrounds."
Thank you for the review! I'm currently working on another PR. Will come back once the other one is landed!
Commit queue failed; closing this roll.
Hey @dkwingsmt is this change still on your radar?
"I decided to go thorough usages of `ScrollOffsetCorrection` in GitHub issues and found these related issues: https://github.com/flutter/flutter/issues/99158 and https://github.com/flutter/flutter/issues/165414. This seems to solve both issues, of course only for the case of calculable extents, (with placeholder extents being valid here). Ping @ksokolovskyi 

I also found https://github.com/flutter/flutter/issues/52207"
Thank you for this amazing change! My first round of review focuses on the constants for the spring simulation.
"```dart
class _StretchSimulation extends Simulation {
  _StretchSimulation(double distance, double velocity, Tolerance tolerance)
      : _dampedFreq = _naturalFrequency * math.sqrt(1 - _dampingRatio * _dampingRatio),
        _cosCoeff = distance,
        _sinCoeff = (1 / (_naturalFrequency * math.sqrt(1 - _dampingRatio * _dampingRatio))) *
            (_dampingRatio * _naturalFrequency * distance + velocity),
        _velocity = velocity,
        super(tolerance: tolerance);
  
  final double _dampedFreq;
  final double _cosCoeff;
  final double _sinCoeff;
  final double _velocity;

  // Physical constants ported directly from Android's EdgeEffect.java.
  static const double _naturalFrequency = 24.657;
  static const double _dampingRatio = 0.98;
  static const double _timeCorrectionFactor = 0.8;

  @override
  double x(double time) {
    final double correctedTime = time * _timeCorrectionFactor;

    // This is the direct port of the distance calculation from Android's
    // damped harmonic oscillator formula.
    return math.pow(math.e, -_dampingRatio * _naturalFrequency * correctedTime) *
        (_cosCoeff * math.cos(_dampedFreq * correctedTime) + _sinCoeff * math.sin(_dampedFreq * correctedTime));
  }

  @override
  double dx(double time) {
    // To calculate the velocity (the derivative of x(t)), we apply the same
    // time correction.
    final double correctedTime = time * _timeCorrectionFactor;

    // The derivative calculation ported from the original Android 12 code.
    final double position = x(time);
    final double uncorrectedDx = position * (-_naturalFrequency) * _dampingRatio +
        math.pow(math.e, -_dampingRatio * _naturalFrequency * correctedTime) *
            (-_dampedFreq * _cosCoeff * math.sin(_dampedFreq * correctedTime) +
              _dampedFreq * _sinCoeff * math.cos(_dampedFreq * correctedTime));

    return uncorrectedDx * _timeCorrectionFactor;
  }

  @override
  bool isDone(double time) {
    // The simulation is considered done when both position and velocity
    // are within the tolerance thresholds. This logic is similar to Android's
    // isAtEquilibrium().
    return x(time).abs() < tolerance.distance && dx(time).abs() < tolerance.velocity;
  }
}
```

@dkwingsmt I thought it wouldn‚Äôt be possible to achieve the exact same effect with Flutter‚Äôs built-in SpringSimulation‚Äîat best, it could only look somewhat similar. So I ported the original Android code and reworked it into a simulation form. The problem is that the motion feels about 1.5x faster (I can fix it by just multiplying by around 0.8), but I‚Äôm not sure why. Could this discrepancy be due to a difference in how Flutter and Android handle their simulation logic?

By the way, the simulation seems identical to the original Android one as long as I adjust the speed!"
Oh I see you have https://github.com/zulip/zulip-flutter/pull/1833 out already. Thanks for that!
"In test for zulip, it's still being checked out to `c87de4169b2c79e38d73c9d79ecbcc63f2e603de`. Could you update it to the new commit `313f8caff7099b0991fc50cb116ae7145e459152`?"
@dkwingsmt When would you be able to review this?
"Hi! I'm very sorry for the late review. We've been a bit busy lately, especially with a summit last week. But I'll review it right now."
"Regarding simulation param: This is so cool! I'm so excited that you can find the Android code and replicate it in Flutter. Since your code is basically a damped spring, I was able to convert it to Flutter's spring simulation:

```dart
  final Simulation stretch = StretchSimulation(10, 1, Tolerance.defaultTolerance);
  for (double t = 0; t < 1; t += 0.1) {
    print('Stretch($t) = ${stretch.x(t)}');
  }

  // Physical constants ported directly from Android's EdgeEffect.java.
  const double kNaturalFrequency = 24.657;
  const double kDampingRatio = 0.98;
  const double kTimeCorrectionFactor = 0.8;

  const double kStiffness = kNaturalFrequency * kNaturalFrequency;
  final SpringDescription springDescription =
      SpringDescription.withDampingRatio(
          mass: 1, stiffness: kStiffness, ratio: kDampingRatio);

  final Simulation spring = SpringSimulation(springDescription, 10, 0, 1);
  for (double t = 0; t < 1; t += 0.1) {
    print('Spring($t) = ${spring.x(kTimeCorrectionFactor * t)}');
  }
```

They gave the same result as long as the Flutter version also uses the timeCorrectionFactor.
```
flutter: Stretch(0.0) = 10.0
flutter: Stretch(0.1) = 4.07408596499882
flutter: Stretch(0.2) = 0.8799738842349217
flutter: Stretch(0.30000000000000004) = 0.14999067992515963
flutter: Stretch(0.4) = 0.021680827237545313
flutter: Stretch(0.5) = 0.002656703351596544
flutter: Stretch(0.6) = 0.0002564212307430861
flutter: Stretch(0.7) = 0.000012938602458735777
flutter: Stretch(0.7999999999999999) = -0.0000019092137489869062
flutter: Stretch(0.8999999999999999) = -7.813953057815709e-7
flutter: Stretch(0.9999999999999999) = -1.689591067594363e-7
flutter: Spring(0.0) = 10.0
flutter: Spring(0.1) = 4.074085964998819
flutter: Spring(0.2) = 0.8799738842349216
flutter: Spring(0.30000000000000004) = 0.14999067992515955
flutter: Spring(0.4) = 0.021680827237545292
flutter: Spring(0.5) = 0.002656703351596539
flutter: Spring(0.6) = 0.0002564212307430852
flutter: Spring(0.7) = 0.00001293860245873564
flutter: Spring(0.7999999999999999) = -0.000001909213748986927
flutter: Spring(0.8999999999999999) = -7.813953057815737e-7
flutter: Spring(0.9999999999999999) = -1.689591067594365e-7
```

In order to bake the time correction factor into our simulation, we need to do the following things:
* Multiply `naturalFrequency` by `kTimeCorrectionFactor` (effectively multiplying `stiffness` by `kTimeCorrectionFactor^2`)
* Multiply starting velocity by `kTimeCorrectionFactor`.

This is the resulting code:
```dart
  final Simulation spring2 = SpringSimulation(
      SpringDescription.withDampingRatio(
          mass: 1,
          stiffness: kStiffness * kTimeCorrectionFactor * kTimeCorrectionFactor,
          ratio: kDampingRatio),
      10,
      0,
      /*velocity*/ 1 * kTimeCorrectionFactor);
  for (double t = 0; t < 1; t += 0.1) {
    print('Spring2($t) = ${spring2.x(t)}');
  }
```
The result proved the same:
```
flutter: Spring2(0.0) = 10.0
flutter: Spring2(0.1) = 4.07408596499882
flutter: Spring2(0.2) = 0.8799738842349218
flutter: Spring2(0.30000000000000004) = 0.14999067992515971
flutter: Spring2(0.4) = 0.02168082723754534
flutter: Spring2(0.5) = 0.0026567033515965495
flutter: Spring2(0.6) = 0.00025642123074308724
flutter: Spring2(0.7) = 0.00001293860245873592
flutter: Spring2(0.7999999999999999) = -0.00000190921374898688
flutter: Spring2(0.8999999999999999) = -7.813953057815676e-7
flutter: Spring2(0.9999999999999999) = -1.6895910675943604e-7
```

Can you rewrite the `_StretchSimulation` part with this? Also explain that the time correction factor is derived from eyeballing and is needed due to unknown reason. Here's my proposal:
```
  // A correction factor applied to the simulation time.
  //
  // The physical constants `_naturalFrequency` and `_dampingRatio` were ported
  // directly from Android's `EdgeEffect.java` source. However, using these
  // constants as-is resulted in an animation that was noticeably faster than
  // the native Android behavior. The underlying reason for this discrepancy is
  // unknown.
  //
  // This factor, determined by visual comparison (""eyeballing"") to match the
  // platform's timing, is applied to the elapsed time `t` to slow down the
  // simulation.
  //
  // Based on the damped harmonic oscillator equations, an alternative,
  // mathematically equivalent, approach would be to multiply both the
  // `_naturalFrequency` and the initial velocity by this same factor,
  // rather than scaling the time input.
```"
I'm looking for someone more familiar with overscrolling to give a 2nd review.
The customer test failure seems to be real. Can you take a look?
"@dkwingsmt https://github.com/flutter/tests/pull/471 https://github.com/zulip/zulip-flutter/pull/1833
I already fixed the customer test failure, but I need to change the checkout because the zulip test was a problem."
"> [flutter/tests#471](https://github.com/flutter/tests/pull/471) [zulip/zulip-flutter#1833](https://github.com/zulip/zulip-flutter/pull/1833) I already fixed the customer test failure, but I need to change the checkout because the zulip test was a problem.

Once [flutter/tests#471](https://github.com/flutter/tests/pull/471) lands (it looks like there is a conflict right now), we'll need another PR to bump the version of flutter/tests that flutter/flutter checks out for customer_testing - dev/customer_testing/tests.version"
I can help with the Google test failures once customer_testing is set.
The customer_testing and other test issues have been resolved.
I'd let @Piinks double check one last time with everything. However @Piinks is out for the week and will return by Oct 20. 
Thanks Tong! I am rebasing here since it looks like there is no Google testing instance currently. We need that to validate we have resolved any remaining failures before merging. 
"Checking in here: there are many failing tests behind the Google testing check here. I am working through them to validate the changes are expected, for example screenshot tests that captured the overscroll state."
@MTtankkeo can you make this update in behavior opt-in? I have determined we won't be able to land this based on some of the failures coming from other dependencies that will have to update first once it gets to stable - https://pub.dev/packages/data_table_2 being one of them.
"> @MTtankkeo can you make this update in behavior opt-in? I have determined we won't be able to land this based on some of the failures coming from other dependencies that will have to update first once it gets to stable - https://pub.dev/packages/data_table_2 being one of them.

@Piinks How should I implement the opt-in behavior? Personally, I can‚Äôt think of a good approach right now. Could you provide an example?"
"Failing tests in data_table_2:
- [test 1](https://github.com/maxim-saplin/data_table_2/blob/2a298245b4b5ab66ba3a90196cc5d27ff33c98f9/test/paginated_data_table2_test.dart#L372)
- [test 2](https://github.com/maxim-saplin/data_table_2/blob/2a298245b4b5ab66ba3a90196cc5d27ff33c98f9/test/paginated_data_table2_data_column2_test.dart#L319)
- [test 3](https://github.com/maxim-saplin/data_table_2/blob/2a298245b4b5ab66ba3a90196cc5d27ff33c98f9/test/async_paginated_data_table2_test.dart#L347)

EDIT: I think these are all the failing tests"
"One thing we could do is update data table to soften the affected tests, and roll the updated package into google, and then land this change. It looks like it's been 7 months since the package's last update. "
"@MTtankkeo which do you prefer, updating the package and then returning here, or introducing an opt in?"
"> @MTtankkeo which do you prefer, updating the package and then returning here, or introducing an opt in?

@Piinks Sounds good, I‚Äôll look into fixing the failing tests in the data_table_2 package and open a PR soon."
"If we can avoid adding any new flags, that would be preferred. Did you try setting the destination to `platform=macOS` to see if that fixed it?"
"> If we can avoid adding any new flags, that would be preferred. Did you try setting the destination to `platform=macOS` to see if that fixed it?

  I tested platform=macOS,arch=$arch as suggested. It works, but breaks backward compatibility by forcing all release builds to single-architecture only.

  The problem:
  - Disables universal binary creation by default
  - Users wanting both architectures must build separately on Intel and Apple Silicon, then manually combine with lipo
  - No way to opt-out for projects without architecture constraints

  Why the flag is better:
  - Preserves current behavior (universal binaries by default)
  - Provides explicit opt-in for architecture-limited dependencies: --macos-arch=arm64
  - Clear, documentable solution: ""Use --macos-arch if your dependencies don't support both architectures""

  The flag solves the edge case without breaking the common case.

"
"> I tested platform=macOS,arch=$arch as suggested.

Try without an arch, just `platform=macOS`"
"> > I tested platform=macOS,arch=$arch as suggested.
> 
> Try without an arch, just `platform=macOS`

 I tested just platform=macOS (without arch) as suggested. It still fails with the same error because xcodebuild
  treats platform=macOS as ambiguous and attempts to build for both architectures.

  The warning shows:
  xcodebuild: WARNING: Using the first of multiple matching destinations:
  { platform:macOS, arch:arm64, id:00006020-001820E60A33C01E, name:My Mac }
  { platform:macOS, arch:x86_64, id:00006020-001820E60A33C01E, name:My Mac }

  Despite picking arm64 first, xcodebuild still tries to compile for x86_64, causing the build to fail. The
  destination alone isn't sufficient‚Äîwe must also specify ARCHS build settings to explicitly control which
  architectures to build.

  The --macos-arch flag approach works because it sets both the destination (platform=macOS,arch=arm64) and the
  build settings (ARCHS=arm64, ONLY_ACTIVE_ARCH=YES), giving explicit control without breaking the default universal
   binary behavior."
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"> Note:
> 
> I wasn't able to find the correct readme for this: https://github.com/flutter/flutter/wiki/Debugging-the-engine#debugging-windows-builds-with-visual-studio

@srivats22 Looks like https://github.com/flutter/flutter/blob/e74c5954502f51a5cb2089320767dfab8f611168/docs/engine/Debugging-the-engine.md?plain=1#L111"
A rerun might work because the initial failure was a failure to download. I just manually recreated the url and was able to download the file. My guess is this was put up before the engine was done uploading the referenced hash. 
https://storage.googleapis.com/flutter_infra_release/flutter/cb467e31a54207dc987aca5bb0941c4d2e3fd9ed/dart-sdk-linux-x64.zip
Oop you're right! https://ci.chromium.org/ui/p/dart-internal/builders/flutter/Linux%20flutter_release_builder/1100/overview probably needs to finish first before I can land this.
Commit queue failed; closing this roll.
Pinging back to the top of my inbox to check on the Google testing results.
"Following up on Google testing, it looks like this breaks a couple of things in subtle ways that might be hard for developers to diagnose and fix. There is at least one custom scroll position class in the google testing set that looks to have caused some test failures. Separately there are some screen shot tests that show that the scroll position is not the same with this change.
Do you have thoughts on options to make this a non-breaking change?"
@yiiim Hi! Are you able to address the comments above? (From triage)
"> Following up on Google testing, it looks like this breaks a couple of things in subtle ways that might be hard for developers to diagnose and fix. There is at least one custom scroll position class in the google testing set that looks to have caused some test failures. Separately there are some screen shot tests that show that the scroll position is not the same with this change. Do you have thoughts on options to make this a non-breaking change?

Thank you for your feedback. After carefully reviewing the implementation, I couldn't find an alternative approach to achieve the desired functionality without introducing a breaking change. If you have any suggestions or ideas, I would be happy to explore them further."
"> I have added maxLayoutCycles. Could you rerun the Google tests and try again?

Rebasing to rerun üëç "
"Changes since last review:
* Added `MediaQueryData.applyTextStyleOverrides` to reset/set text spacing overrides, text spacing overrides removed from `copyWith` since they cannot be reset to `null` through it.
* `StrutStyle.merge` added so we can create `StrutStyle` with `height` overridden with `lineHeightScaleFactor`.
* Text spacing overrides now penetrate text span tree using `_OverridingTextStyleTextSpanUtils`, a wrapper that recreates text spans (excluding subclasses) with the provided overrides. This is temporary as we design an API that allows us to override styles for an entire `InlineSpan` tree. Work for that can be tracked here https://github.com/flutter/flutter/issues/177952"
I've filed a PR https://github.com/flutter/flutter/pull/176992 that adds CI tasks to test leak tracking for `flutter_test`. Let's wait until that PR is decided.
@hgraceb Any thoughts on what should be done about the failing go_router test? Is that something that this PR could work around?
"@victorsanni @justinmc @ValentinVignal 

The modifications in the `go_router` PR at [#7456](https://github.com/flutter/packages/pull/7546/files#diff-cadb5f44a1e75aa2a6e8a28c017283db7218cafdd8e170731db9aa655e2ec22aR77) are preventing the current PR from being merged.

From my understanding, the changes in [#7456](https://github.com/flutter/packages/pull/7546/files#diff-cadb5f44a1e75aa2a6e8a28c017283db7218cafdd8e170731db9aa655e2ec22aR77) and my current modifications are equivalent; both aim to address the leakage issue with `TestWidgetsFlutterBinding.restorationManager` after enabling leak testing. However, the changes in [#7456](https://github.com/flutter/packages/pull/7546/files#diff-cadb5f44a1e75aa2a6e8a28c017283db7218cafdd8e170731db9aa655e2ec22aR77) seem more like a temporary patch.

I believe the changes in `go_router` should be reverted, and after merging the current PR, the effect would remain the same as before. However, if I submit a separate PR for `go_router` now, both tests will fail; they will only pass if changes are made on both sides simultaneously. 

Does anyone have good suggestions on how to proceed?"
"1. Revert the unwanted changes in go_router + disable leak memory testing for those specific tests, for example using:
```dart
  testWidgets(
    'Date formatting test',
    (WidgetTester tester) async {},
    experimentalLeakTesting: LeakTesting.settings.withIgnored(
      classes: const ['TestRestorationManager'],
    ),
  );
```

and add a TODO to remove it when go_router's minimum flutter version includes this PR

2. Merge this PR
3. Remove the ignore part in go_router when the minimum version of flutter includes this fix.
```dart
experimentalLeakTesting: LeakTesting.settings.withIgnored(
      classes: const ['TestRestorationManager'],
    ),
```


What do you think of that?"
"@ValentinVignal This sounds great, I submitted a PR: https://github.com/flutter/packages/pull/10276."
"Rebasing to rerun google testing.

My understanding is with https://github.com/flutter/packages/pull/10276 the go_router failures should be fixed?"
"I don't think it's possible to verify the dragging behavior at zero size. We might be able to do it with a small size (such as 1x1, which is effectively almost equivalent. Although, I'm willing to delay it to another day until it's actually found broken due to its potential difficulty, but feel free to give it a try if you'd like to."
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
@camsim99 No this should be safe to land
"An existing Git SHA, `3f9c2abab50ede44de5e46d1f4676e8e361467d1`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"An existing Git SHA, `927d432f9ea50176babca2e5d15914e66a282a67`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
" @okorohelijah please fill out the PR description above, afterwards the release team will review this request."
Is this different from https://github.com/flutter/flutter/pull/178132 ? I'm planning to land that one
"no it isn't different, i can close this "
This PR is stuck in the merge queue (Something is going on between GitHub and Cocoon today) - removing and re-inserting.
" @bkonyi please fill out the PR description above, afterwards the release team will review this request."
" @mdebbar please fill out the PR description above, afterwards the release team will review this request."
Commit queue failed; closing this roll.
" @bkonyi please fill out the PR description above, afterwards the release team will review this request."
Taking this over in https://github.com/flutter/flutter/pull/178308
Commit queue failed; closing this roll.
@gmackall I want you to look at the places where we throw and api exception and decide if you agree we should remove those or not. 
"> Looks good, please undo the listener changes that are unrelated to the api 23 code removal.

done "
This will take work from a googler. There are some tests that are failing because they assume the min is api 23 not 24. 
"Can you try updating any values of `android_api_level` below 24 to 24 in 
https://github.com/flutter/flutter/blob/75d7be622c8443dc9f248ef802af012df9553a83/engine/src/build/config/android/config.gni#L22
?
Also ideally this comment as well
https://github.com/flutter/flutter/blob/75d7be622c8443dc9f248ef802af012df9553a83/engine/src/build/toolchain/android/BUILD.gn#L148"
"the `Linux flutter_plugins` is unrelated ,error:
```Running command: ""dart analyze --fatal-infos"" in /b/s/w/ir/x/t/flutter_packages.HMSZCB/packages/google_maps_flutter/google_maps_flutter_web
Analyzing google_maps_flutter_web...

  error - example/integration_test/overlay_test.dart:44:31 - A value of type 'Size?' can't be assigned to a variable of type 'Size'. Try changing the type of the variable, or casting the right-hand type to 'Size'. - invalid_assignment```  "
"Not sure why the google testing wasn't running automatically, lets see if it works now"
This looks good to go. May I add the autosubmit tag?
"@chinmaygarde [I thought this required a g3 cl](https://github.com/flutter/flutter/pull/175508#issuecomment-3324904689) to land this. I dont see google testing running against this pr. 

There were failures related to this pr that were needed in g3. 
"
"Oh, I figured that was already done since all checks were green. "
"I manually kicked off a google testing pass that is now running. 
"
@AbdeMohlbi FYI @ash2moon is working on the g3 fix for this pr. Nothing you can do until he is done. Wanted to make sure you knew the team is actively working on getting this landed. 
"> @AbdeMohlbi FYI @ash2moon is working on the g3 fix for this pr. Nothing you can do until he is done. Wanted to make sure you knew the team is actively working on getting this landed. 

Noted ‚úÖ"
"> I'm not sure why Google Testing didn't kick off on the last merge, I'm going to mark this as ""request changes"" until we get this resolved on the Google testing side so this doesn't accidentally get merged and need to be reverted post-submit. @AbdeMohlbi thank you so much for your patience!

no issue thank u for the info , i'm not sure but it may be related , smth simular happend in another PR where i was not a member at the time when that PR was created  then when i became a member , google testing didn't kick off as usual maybe it's the same issue."
"Update from our side @ash2moon is working on migrating google apps. I didnt realize the number that had not migrated and some of those apps have policies around minimum api level bumping that we are working through. This pr will need to sit until that work is done. Probably at least a couple of weeks. 

"
Update from google migration. We have one customer left not migrated before we can land this pr. All of the migration code is written and we are waiting on them to review it. 
@matanlurey You labeled the referenced issue as still valid. Are you interested in reviewing this PR? 
"Thank you for the contribution.

The change is basically bypassing the check if `localeString == fileName`. But doing it in an inner loop makes the code more difficult to understand. Can we add the check outside the loop instead?

---

The other issue I think the code has, is that the loop serves two purposes, to check if the locale provided is the same as in the file name, and if the locale is not provided, attempt to read the locale from the filename.

My suggestion for this PR, to make it clearer, and slightly more robust:

1. If `'@@locale'` is not null, use that as the `localeString`. Check if `filename == localeString || filename.endsWith('_' + localeString)`, and throw an error if it doesn't. (This check might be a breaking change to some users.)
2. If `'@@locale'` is null, then we go through the for loop to determine the `localeString` that should be used. And make a change so that we also try to parse the whole filename as the locale, and after every underscores.

What do you think?"
"I just realized that I misunderstood the change when I left the comment yesterday. But I think my suggestions still apply. I've updated the comment above, thanks!"
"Hi @Mr-Pepe, are you still interested in pursuing this PR?"
"@bkonyi Yes, but I'll have to find time to fully understand @chingjun's comment"
Commit queue failed; closing this roll.
Subscribed
"Reason for revert: DWDS roll likely breaking Linux web_benchmarks_ddc_hot_reload, Linux web_benchmarks_ddc"
"Thanks for the contribution @777genius! Do you happen to know if there's already an issue filed for this? If so, could you link it here? Otherwise, we should file an issue describing the problem so that we can continue to track work in this area.

This approach does work, but I'm sure if you're encountering this issue for Cyrillic keyboard layouts, other users are encountering if with other layouts as well. This means that we should probably come up with a more generalizable solution that allows for us to add mappings for other languages as well without having to introduce case statements for each individual mapping.

I think this can be done by creating a `String mapKeyToLatin(String key)` which will try and lookup `key` in a `Map<String, String>`, returning the latin character if the `key` has a valid mapping, and returning `key` itself otherwise. Then we don't have to add new cases to the `switch` statement, and we can have a constant `Map` that can be easily updated with new mappings as they're requested."
"Hi @777genius, is this something you're still interested in pursuing?"
"Thank you for the feedback, @bkonyi! You're absolutely right about making this more generalizable. I found several related issues that confirm this is a broader problem affecting multiple keyboard layouts:

#27021 - Flutter run not handling keypresses with non-English layouts (Cyrillic, closed in 2020 but the terminal command issue persists)
#100456 - Keyboard layout analysis for non-Latin layouts, specifically mentions Cyrillic users
#116658 - Making shortcuts portable across different keyboard layouts
I agree that using a Map<String, String> approach is much cleaner and more maintainable. I'll refactor the implementation to:

I agree that using a Map<String, String> approach is much cleaner and more maintainable. I'll refactor the implementation to use your suggested approach:

1. Create a constant map with all keyboard layout mappings:

``` dart
/// Maps non-Latin keyboard layout characters to their Latin equivalents
/// based on physical key positions.
///
/// This allows users with non-Latin keyboard layouts to use terminal commands
/// without switching layouts. Contributors can add mappings for additional
/// layouts (Arabic, Hebrew, Greek, etc.) by adding entries to this map.
const Map<String, String> _keyboardLayoutMappings = {
  // Cyrillic (Russian –ô–¶–£–ö–ï–ù) layout -> QWERTY Latin
  '–∫': 'r', '–ö': 'R',  // hot reload / hot restart
  '–π': 'q', '–ô': 'Q',  // quit
  '—Ü': 'w', '–¶': 'W',  // dump widget tree
  '—Ä': 'h', '–†': 'H',  // help
  '—ã': 's', '–´': 'S',  // screenshot / semantics
  '–≤': 'd', '–í': 'D',  // detach
  '–∞': 'f', '–ê': 'F',  // dump focus tree
  '–ø': 'g', '–ü': 'G',  // run source generators
  '—à': 'i', '–®': 'I',  // widget inspector / invert images
  '–¥': 'l', '–î': 'L',  // dump layer tree
  '—â': 'o', '–©': 'O',  // toggle platform
  '–∑': 'p', '–ó': 'P',  // debug paint / performance overlay
  '—Ç': 'n', '–¢': 'N',  // (reserved for future use)
  '–µ': 't', '–ï': 'T',  // dump render tree
  '–≥': 'u', '–ì': 'U',  // dump semantics (inverse hit test)
  '–º': 'v', '–ú': 'V',  // open DevTools
  // TODO: Add mappings for other non-Latin layouts as needed
};
```

2. Implement the lookup function:

``` dart
/// Maps a keyboard character to its Latin equivalent if a mapping exists.
/// Returns the original character if no mapping is found.
String _mapKeyToLatin(String key) {
  return _keyboardLayoutMappings[key] ?? key;
}
```

3. Use it at the start of the command handler:

``` dart
Future<bool> _commonTerminalInputHandler(String character) async {
  // Map non-Latin characters to Latin equivalents based on physical key position
  character = _mapKeyToLatin(character);
  
  _logger.printStatus('');
  switch (character) {
    case 'a':
      return residentRunner.debugToggleProfileWidgetBuilds();
    case 'r':
      // ... existing hot reload logic
    // ... rest of the switch statement remains unchanged
  }
}
```

This approach has several benefits:

- New keyboard layouts can be added by simply extending the map
- No changes needed to the switch statement logic
- Easy for contributors to add their own layouts
- Clear documentation showing which keys map to which commands

How do you like the solution?"
That sounds good to me!
"Greetings from stale PR triage! üëã 
Is this change still on your radar?"
"Yes, I'll pick it back up this week or close it :)"
Commit queue failed; closing this roll.
"Some test failures: 
```
06:03 +739 ~1 -1: test/commands.shard/permeable/create_test.dart: app does not include ios if disabled in config [E]
  Expected: not a file system entity that exists
    Actual: ErrorHandlingDirectory:<LocalDirectory: '/b/s/w/ir/x/t/flutter_tools.EBRPEX/flutter_tools_create_test.UMYZJU/flutter_project/ios'>
```
```
09:15 +874 ~2 -2: test/commands.shard/permeable/create_test.dart: app does not include desktop or web by default [E]
  Expected: not a file system entity that exists
    Actual: ErrorHandlingDirectory:<LocalDirectory: '/b/s/w/ir/x/t/flutter_tools.MRWEKF/flutter_tools_create_test.XRILCZ/flutter_project/macos'>
```
https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8701985648264674337/+/u/run_test.dart_for_tool_tests_shard_and_subshard_commands/stdout"
"> This LGTM, I'd like @vashworth to also check it out though, particularly the template changes, and SwiftPM specifically. I'm hoping there's an easy way to not have a separate darwin gitignore as well?

Unfortunately, I don't think there's an easy way to have a shared gitignore because it's in a different directory."
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"> I see a lot of TextPainters that are created, laid out, and then quickly disposed. For performance reasons, I wonder if there are any opportunities to cache and reuse any of these TextPainters? They can cheaply paint multiple times if their parameters haven't changed and a relayout isn't needed. If this significantly increases code complexity though, then it's probably not worth it until we have a reason to think performance is a bottleneck.

> Also another general comment, it looks like there is a lot of drawing code that is almost the same repeated in a couple of different places for various types/parts of slider. I wonder if there's any opportunity to reuse some generic code? This is not the fault of this PR, it was like that beforehand, but this is just a heads up in case you see any opportunities where it makes sense to DRY things up.

Thank you for reviewing this, Justin! I‚Äôll look into these suggestions next week and consider any optimizations."
"Hi @justinmc, after looking at this fix again, I also think implementing cache for TextPainters may increase code complexity with minimal benefit and may result in higher maintenance costs. However, if you think this is necessary, please let me know. 

Instead, I did improve the fix a bit with a cleanup, what I did was to do code deduplication text processing(`maxLines` truncation and ellipsis creation) inside `***PathPainter.paint() methods`: Extract common multiline text processing inside paint methods of `_DropSliderValueIndicatorPathPainter` and `_RoundedRectSliderValueIndicatorPathPainter` into a reusable class/method. 

- Before:
```dart
    TextPainter finalLabelPainter = labelPainter;
    if (multilineConfig.enabled && multilineConfig.maxLines != null) {
      finalLabelPainter = TextPainter(
        text: labelPainter.text,
        textDirection: labelPainter.textDirection,
        textScaleFactor: textScaleFactor,
        maxLines: multilineConfig.maxLines,
      )..layout();

      // If lines were truncated, add ellipsis manually.
      if (finalLabelPainter.didExceedMaxLines) {
        finalLabelPainter.dispose(); // Dispose the intermediate painter
        finalLabelPainter = _createTextPainterWithEllipsis(
          originalPainter: labelPainter,
          originalText: labelText,
          maxLines: multilineConfig.maxLines!,
          textScaleFactor: textScaleFactor,
        );
      }
    }
...
if (finalLabelPainter != labelPainter) {
      finalLabelPainter.dispose();
    }
```
- After: Create a reusable class `_ValueIndicatorTextProcessor` for using inside `***PathPainter.paint()`:
<details>
<summary>_ValueIndicatorTextProcessor</summary>

```dart
/// Utility class for processing multiline text in value indicators.
class _ValueIndicatorTextProcessor {
  const _ValueIndicatorTextProcessor._();

  /// Processes multiline text for value indicators, handling maxLines
  /// truncation and ellipsis.
  ///
  /// Returns the appropriate TextPainter based on the multiline configuration.
  /// The caller is responsible for disposing the returned TextPainter
  /// if it differs from the original.
  static TextPainter processMultilineText({
    required TextPainter originalPainter,
    required ValueIndicatorMultilineConfig multilineConfig,
    required double textScaleFactor,
  }) {
    final String labelText = originalPainter.text?.toPlainText() ?? '';

    if (!multilineConfig.enabled || multilineConfig.maxLines == null) {
      return originalPainter;
    }

    final TextPainter truncatedPainter = TextPainter(
      text: originalPainter.text,
      textDirection: originalPainter.textDirection,
      textScaleFactor: textScaleFactor,
      maxLines: multilineConfig.maxLines,
    )..layout();

    if (!truncatedPainter.didExceedMaxLines) {
      return truncatedPainter;
    }

    truncatedPainter.dispose();
    return _createTextPainterWithEllipsis(
      originalPainter: originalPainter,
      originalText: labelText,
      maxLines: multilineConfig.maxLines!,
      textScaleFactor: textScaleFactor,
    );
  }

  /// Safely disposes a TextPainter if it was created by processMultilineText.
  /// Does nothing if the painter is the same as the original.
  static void disposeIfCreated(TextPainter painter, TextPainter original) {
    if (painter != original) {
      painter.dispose();
    }
  }
}
```
</details>


```dart
    final TextPainter finalLabelPainter = _ValueIndicatorTextProcessor.processMultilineText(
      originalPainter: labelPainter,
      multilineConfig: multilineConfig,
      textScaleFactor: textScaleFactor,
    );
...
_ValueIndicatorTextProcessor.disposeIfCreated(finalLabelPainter, labelPainter);
```

 Benefits we gained:
  - Reduces duplicated code in paint methods for those PathPainter classes
  - Centralized multiline text handling logic to improve maintainability and facilitate testing"
"Hi @justinmc, all checks have passed. Could you please take a look again?"
"> ok I initially thought the additional text painter was for figuring out the number of lines visible if you render a document in a fixed size box. But it looks like the new API takes `maxLines` so I'm a bit confused as to why the additional text painter is needed? Can't we tell the owner of the text painter about `maxLines` and let it set max lines on the `TextPainter`?

Thanks for pointing this out! I had to look back at the case `actualLines <= maxLines` in `_ValueIndicatorTextProcessor.processMultilineText`: it's indeed unnecessary, we can just return the original text painter. 

-----

@justinmc @LongCatIsLooong I have made a new [commit](https://github.com/flutter/flutter/pull/173324/commits/eacec9b824f4f1be6a9d4b524f1c32081783e274) that incorporates all of your ideas. Please let me know how it is!"
"> > ok I initially thought the additional text painter was for figuring out the number of lines visible if you render a document in a fixed size box. But it looks like the new API takes `maxLines` so I'm a bit confused as to why the additional text painter is needed? Can't we tell the owner of the text painter about `maxLines` and let it set max lines on the `TextPainter`?
> 
> Thanks for pointing this out! I had to look back at the case `actualLines <= maxLines` in `_ValueIndicatorTextProcessor.processMultilineText`: it's indeed unnecessary, we can just return the original text painter.
> 
> @justinmc @LongCatIsLooong I have made a new [commit](https://github.com/flutter/flutter/pull/173324/commits/eacec9b824f4f1be6a9d4b524f1c32081783e274) that incorporates all of your ideas. Please let me know how it is!

I think my question is, why do we have to create a new TextPainter? Can we tell the creator of the TextPainter to use `maxLine`?"
"> why do we have to create a new TextPainter?

@LongCatIsLooong: Could you please point out which part in the fix (LOC)? Before I pushed the new [commit](https://github.com/flutter/flutter/pull/173324/commits/eacec9b824f4f1be6a9d4b524f1c32081783e274), I created a redundant painter at [here](https://github.com/flutter/flutter/pull/173324/commits/04dd854159bd4cddcf315677df5cbddbdd0162dd#diff-72d0f76e314d68c31828a3ccd11383ae73b2c528f0ab95725f6d6a8082497811R879-R884), then turned out it was unnecessary, then I removed it in the last [commit](https://github.com/flutter/flutter/pull/173324/commits/eacec9b824f4f1be6a9d4b524f1c32081783e274). If you refer to the painter in `_createTextPainterWithEllipsis`, I would explain it's due to `TextPainter.ellipsis` built-in API is not working as desired in this case (I don't know the reason), that's why I had to create a painter with ellipsis manually. 

Additionally, when I attempted to use these setters (ellipsis, maxLines), they didn't work. They seem to work in TextPainter's constructor only and can't be modified after the object is created and laid out.

```dart
_textPainter.ellipsis = '...';
_textPainter.maxLines = maxLines;
_textPainter..layout();
```"
"> I would explain it's due to TextPainter.ellipsis built-in API is not working as desired in this case (I don't know the reason)

I think we should fix that instead of working around it. Is there a tracking issue? I'm not aware of ellipsis bugs other than the one that happens when maxLines set to null (it shows only one line in that case)."
"> I think we should fix that instead of working around it. Is there a tracking issue? I'm not aware of ellipsis bugs other than the one that happens when maxLines set to null (it shows only one line in that case).

@LongCatIsLooong I think it's https://github.com/flutter/flutter/issues/50168 (and also relates to https://github.com/flutter/flutter/issues/167466, but I think we can dedup 167466 into 50168 as 50168 is an underlying issue, correct?).

I also made another simple reproduction here to illustrate Slider scenario in this PR: it basically renders a text with TextPainter inside a OverlayPortal:

<details>
<summary>Sample code</summary>

```dart
import 'package:flutter/material.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: TextPainterSample(),
    );
  }
}

class TextPainterSample extends StatefulWidget {
  const TextPainterSample({super.key});

  @override
  _TextPainterSampleState createState() => _TextPainterSampleState();
}

class _TextPainterSampleState extends State<TextPainterSample> {
  final OverlayPortalController _overlayController = OverlayPortalController();

  final String testText = '''Line 1: This is a long line of text
Line 2: Another long line of text
Line 3: Yet another long line
Line 4: More text content here
Line 5: Additional text content
Line 6: Even more text here
Line 7: Continuing with more text
Line 8: Still adding more lines
Line 9: Almost at the end
Line 10: Final line of text''';
  int? maxLines;
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('TextPainter ellipsis sample')),
      body: Center(
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            ElevatedButton(
              onPressed: () {
                setState(() {
                  maxLines = null;
                });
              },
              child: Text('maxLines null'),
            ),
            ElevatedButton(
              onPressed: () {
                setState(() {
                  maxLines = 5;
                });
              },
              child: Text('maxLines = 5'),
            ),
            Text('maxLines: $maxLines'),
            Divider(
              height: 20,
              color: Colors.amber,
              thickness: 8,
            ),
            Row(
              crossAxisAlignment: CrossAxisAlignment.end,
              children: [
                CustomPaint(
                  size: Size(200, 100),
                  painter:
                      EllipsisTextPainter(text: testText, maxLines: maxLines),
                ),
                OverlayPortal(
                  controller: _overlayController,
                  overlayChildBuilder: (context) {
                    return Positioned(
                      top: 180,
                      left: 260,
                      child: Material(
                        elevation: 8,
                        borderRadius: BorderRadius.circular(8),
                        child: Container(
                          width: 300,
                          padding: EdgeInsets.all(16),
                          decoration: BoxDecoration(
                            color: Colors.white,
                            borderRadius: BorderRadius.circular(8),
                          ),
                          child: CustomPaint(
                            size: Size(200, 80),
                            painter: EllipsisTextPainter(
                                text: testText, maxLines: maxLines),
                          ),
                        ),
                      ),
                    );
                  },
                  child: ElevatedButton(
                    onPressed: () {
                      _overlayController.toggle();
                    },
                    child: Text('Toggle Overlay'),
                  ),
                ),
                ColoredBox(
                  color: Colors.red,
                  child: SizedBox(
                    width: 200,
                    height: 100,
                    child: Text(
                      testText,
                      maxLines: maxLines,
                      overflow: TextOverflow.ellipsis,
                    ),
                  ),
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }
}

class EllipsisTextPainter extends CustomPainter {
  final String text;
  final int? maxLines;
  EllipsisTextPainter({required this.text, this.maxLines});

  @override
  void paint(Canvas canvas, Size size) {
    final textPainter = TextPainter(
      text: TextSpan(
        text: text,
        style: TextStyle(
          color: Colors.black,
          fontSize: 14,
        ),
      ),
      textDirection: TextDirection.ltr,
      maxLines: maxLines,
      ellipsis: '...',
    );

    textPainter.layout(maxWidth: size.width);
    textPainter.paint(canvas, Offset.zero);
  }

  @override
  bool shouldRepaint(covariant CustomPainter oldDelegate) => false;
}

```
</details>

<details>
<summary>Demo screenshot/video</summary>

https://github.com/user-attachments/assets/a88896d1-1503-4c2f-979b-500c5ed25f10

</details>

Let me know if this case is not similar to issues mentioned and needs to be tracked separately, then I can file an issue for tracking."
"https://github.com/flutter/flutter/issues/50168 doesn't look difficult to fix (but it may break some existing tests). I think it would be better to add a TODO instead of working around the bug (if the workaround works well then it should probably be moved to the TextPainter implementation, if it doesn't then we shouldn't use that)."
"> #50168 doesn't look difficult to fix (but it may break some existing tests). I think it would be better to add a TODO instead of working around the bug (if the workaround works well then it should probably be moved to the TextPainter implementation, if it doesn't then we shouldn't use that).

I added a TODO and also filed https://github.com/flutter/flutter/issues/175251 for this."
"> I'd recommend that we remove the workaround (and pretend the bug doesn't exist in this implementation) if possible. The reason for that is that I think it's pretty difficult to get the ellipsis implementation right here (in slider_parts.dart) but it should be an easy change in skparagraph (see the comments above).

It's fine to remove the workaround, but there is another aspect that I'm unsure if it can achieve the same result (text is ellipsized by height) once it's solved in `skparagraph` as said. Per `TextPainter.ellipsis` was documented here; it seems to be constrained to width only:

https://github.com/flutter/flutter/blob/844edbcd91ba0aa7b1b2d8d809689c69ebeb7222/packages/flutter/lib/src/painting/text_painter.dart#L934

If it is definitely expected, I can proceed as suggested. Then I will update as follows:
1. Remove `_createTextPainterWithEllipsis`
2. Simply return a TextPainter with `maxLines` instead"
@LongCatIsLooong (a gentle ping): Could you please take a look at this?
"Sorry for the delay, but I still don't think we should add the workaround for the SkParagraph issue. I think it would make the actual fix a breaking change to land in SkParagraph, since it relies on SkParagraph doing the wrong thing."
@LongCatIsLooong Thanks for your response. I removed the workaround and used TextPainter's built-in API in the last commit. And also closed https://github.com/flutter/flutter/issues/175251 as it's unnecessary to do anymore. Let me know if there are any suggestions for this PR.
Sorry for the delay. Why do we still need the additional text painter if we just assumes `TextPainter` is able to correctly ellipsize at hard line breaks? Wouldn't it be as simple as passing the correct parameters to the TextPainter?
"> Why do we still need the additional text painter if we just assumes TextPainter is able to correctly ellipsize at hard line breaks? Wouldn't it be as simple as passing the correct parameters to the TextPainter?

@LongCatIsLooong It's because the painters in each `<shape-varient>PathPainter.paint()` (_DropSliderValueIndicatorPathPainter, _RoundedRectSliderValueIndicatorPathPainter) were initialized in separate Slider or RangeSlider widgets with empty-constructor instances:

https://github.com/flutter/flutter/blob/dd790ea5daca10939e16298a8316232ac1803c82/packages/flutter/lib/src/material/slider.dart#L1249

https://github.com/flutter/flutter/blob/271338bc18e95f0ccd2f5dc85b9131c1e6a91320/packages/flutter/lib/src/material/range_slider.dart#L1003

I was thinking about overriding the old TextPainter either, but it seems there does not exist `copyWith` or equivalent method.  

Nonetheless, after applying several optimizations based on the suggestions above, a new painter will only be spawned under a specific condition (text exceeds maxLines), and then it is disposed safely afterward."
"> > Why do we still need the additional text painter if we just assumes TextPainter is able to correctly ellipsize at hard line breaks? Wouldn't it be as simple as passing the correct parameters to the TextPainter?
> 
> @LongCatIsLooong It's because the painters in each `<shape-varient>PathPainter.paint()` (_DropSliderValueIndicatorPathPainter, _RoundedRectSliderValueIndicatorPathPainter) were initialized in separate Slider or RangeSlider widgets with empty-constructor instances:
> 
> https://github.com/flutter/flutter/blob/dd790ea5daca10939e16298a8316232ac1803c82/packages/flutter/lib/src/material/slider.dart#L1249
> 
> https://github.com/flutter/flutter/blob/271338bc18e95f0ccd2f5dc85b9131c1e6a91320/packages/flutter/lib/src/material/range_slider.dart#L1003
> 
> I was thinking about overriding the old TextPainter either, but it seems there does not exist `copyWith` or equivalent method.
> 
> Nonetheless, after applying several optimizations based on the suggestions above, a new painter will only be spawned under a specific condition (text exceeds maxLines), and then it is disposed safely afterward.

Would it be possible to let the owner of the TextPainter apply the configuration then? 

> re: copyWith

TextPainter is a mutable object that doesn't have value semantics, so to me it doesn't make a lot of sense for it to have a `copyWith`? 

Also the API feels a bit strange. What makes multiline configurations special so it needs to be put in a separate configuration class? Also why does corner padding only applies to multiline text?"
"> What makes multiline configurations special so it needs to be put in a separate configuration class? 

`ValueIndicatorMultilineConfig` resides in [slider_theme.dart](https://github.com/flutter/flutter/blob/master/packages/flutter/lib/src/material/slider_theme.dart), and it's optional parameter as suggested at https://github.com/flutter/flutter/issues/170204#issuecomment-3130060766. It allows users to be able to enable/disable multiline ability with `enabled` attribute, maximum number of lines to display with `maxLines`, and additional padding for rounded corners with `cornerPadding` .

> Also why does corner padding only applies to multiline text?

It's documented here: 

https://github.com/huycozy/flutter/blob/13a4b07bbd0cf9a04a8a62b53ce1c1afc1149f87/packages/flutter/lib/src/material/slider_theme.dart#L1203

Let me know it makes sense enough or maybe there is a better solution I can try."
"> > What makes multiline configurations special so it needs to be put in a separate configuration class? 
> 
> `ValueIndicatorMultilineConfig` resides in [slider_theme.dart](https://github.com/flutter/flutter/blob/master/packages/flutter/lib/src/material/slider_theme.dart), and it's optional parameter as suggested at https://github.com/flutter/flutter/issues/170204#issuecomment-3130060766. It allows users to be able to enable/disable multiline ability with `enabled` attribute, maximum number of lines to display with `maxLines`, and additional padding for rounded corners with `cornerPadding` .
> 
> > Also why does corner padding only applies to multiline text?
> 
> It's documented here: 
> 
> https://github.com/huycozy/flutter/blob/13a4b07bbd0cf9a04a8a62b53ce1c1afc1149f87/packages/flutter/lib/src/material/slider_theme.dart#L1203
> 
> Let me know it makes sense enough or maybe there is a better solution I can try.

Uhh I don't think this answers my question, why are these configurations only applicable in multiline text, I think the padding for example should be applied to single line text as well? I didn't find the answers in the documentation either. Also I still don't understand why the additional text painter has to be created."
"> I think the padding for example should be applied to single line text as well? I didn't find the answers in the documentation either. 

I see, the question is more clearly now. It's simply to not introduce any regression issues on the common case with a single line text (texts are `""spill out"" of rounded corners` usually happen with multiline text. If we also want to support padding for single line text, we can implement it in a separate feature request I think.

re:

> Also I still don't understand why the additional text painter has to be created.

and also:

> TextPainter is a mutable object that doesn't have value semantics, so to me it doesn't make a lot of sense for it to have a copyWith?

If that so, how can we update the provided/current text painter with new `maxLines` param? If there is no way to do this, creating a new TextPainter seems to be the only solution I can figure out.
"
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Hi @rkishan516 do you still have plans for this change? 
"Hi @Piinks, This was a proposal PR for @justinmc to review. If we want to continue with this, then I can surely update this."
"This has come back around to stale PR triage. We don't review draft PRs, but have you reached out on Discord for the feedback you were seeking?"
"> This has come back around to stale PR triage. We don't review draft PRs, but have you reached out on Discord for the feedback you were seeking?

Hey, last time we couldn't conclude, I will continue that discussion again today."
"> It looks like there are two failing customer tests in the provider package, and they're kind of concerning. I wouldn't expect this change to cause them to fail, but maybe it's because I don't understand the inner workings of provider. Do you know what's causing the failure?
> 
> https://github.com/rrousselGit/provider/blob/558bdcd26ddb2b922bec06e3fa0d91bc59479baf/packages/provider/test/null_safe/context_test.dart#L489-L520

The test is _incorrect_ as per Providers own documentation: https://pub.dev/documentation/provider/latest/provider/ChangeNotifierProvider-class.html#:~:text=DON%27T%20reuse%20an%20existing%20ChangeNotifier%20using%20the%20default%20constructor

> I think I agree with @rrousselGit in the original issue (#106549), who said that this should probably be opt-in. I really can't think of any reasonable situation where you would logically need the original behavior, can you? But I worry due to the (slight) performance effect.
> 
> Overall I agree that Flutter should have this feature, probably behind an opt-in flag.

Maybe tests could be run if this actually affects performance? Because I can also come up with some pathological cases where this should boost performance.

IMO it would be too bad to have the desired / correct behaviour only available behind a flag / different API & having to wait for the entire ecosystem to migrate."
"Thanks @justinmc! I've investigated the failing provider tests and found the bug in my implementation.

The issue was in where `cleanupRemovedDependencies()` was being called. My original implementation called it only once on the root context element in buildScope(), but `_flushDirtyElements` rebuilds many elements during a build cycle.

For the fix, I moved `cleanupRemovedDependencies` from BuildOwner.buildScope() to `ComponentElement.performRebuild`. Now each element cleans up its own dependencies after it rebuilds.

On the opt in choice, I am not really sure. I can see some advantage of opt in, so for now I am also leaning towards it."
"Since the current behavior (never unsubscribe) is intentional, I assume we'll never make this behavior the default. In this case, do you think it'll be easier to have another method to call than to configure this when defining the entire class? This allows the app developers to decide whether to adopt it, so that this feature can be applied to existing inherited models as well.

I'm imagining a `removeDependency` method, since the developer should know the timing that they're no longer using the dependency. Or we can have a slightly smarter method such as `checkDependencyCleanup`. In general my idea is that if the developer feels like unsubscribing, they can call it in similar places as the `dependOn` methods."
"The very reason this feature is requested is that developers _dont_ have a good place to unsubscribe.

Folks can already override InheritedElement.removeDependent.
They thing is that the only mean for a package to know when a dependency is no-longer useful is to override ComponentElement.build. That requires dissociating from Stateless/StatefulWidget, making this solution incompatible with a large chunk of the ecocystem.

(the alternative of providing Builder-like widgets has the same compatibility issue)"
"@dkwingsmt I don't think without breaking change we can add any new perameter or method. Also as @rrousselGit mentioned `developers dont have a good place to unsubscribe`.

I went with current approach, because 
 - InheritedWidget can override `cleanupDependency` to return `true` (if they want)
 - The framework automatically removes dependencies when widgets are removed from the tree or stop calling `dependOnInheritedWidgetOfExactType`
 - Its simplest way to keep API backward compatible."
"I see. Thank you all for explaining, and sorry for the confusion."
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Google testing failures are legitimate. The tests print semantics that match the checked/unchecked states which this PR changes to the selected state.
"@chunhtai I fetched the latest code and rebased for this pr, but Google test is still failing. Perhaps need to update them, too? (maybe some tests there rely on `checked` flag). Could you please give a hand on this?"
@chunhtai  or @victorsanni would one of you be able to take on shepherding this through the Google testing failures? (Thank you in advance üôè )
"> Google testing failures are legitimate. The tests print semantics that match the checked/unchecked states which this PR changes to the selected state.

Google testing failures are semantics goldens, same as above. I will liaise with @chunhtai to apply google fixes to unblock this PR. "
The linter errors are real. Can you address them so we can push this along?
"Hi @victorsanni, thank you for taking a look at this PR and providing such valuable information regarding the native iOS switch behavior.

I've investigated how the UISwitch behaves and updated this PR accordingly. The following screen recording compares the updated `CupertinoSwitch` (top) with a native `UISwitch` (bottom), both overlaid with a 10% grid.

https://github.com/user-attachments/assets/06ae5391-5282-4cda-acd8-f4ebf94f2dbb

As the video demonstrates, the new logic better matches the native behavior:
1) Commit Threshold: The switch requires a drag of ~70% of the track width to commit to the new state. In the video, the drag starts at the ~20% mark and snaps ""on"" at the ~90% mark.
2) Reverse Threshold: While the drag is still active, the switch will not revert to its original state until the user drags back to the ~20% position (relative to the start of the drag). In the video, after the switch snaps ""on,"" it only snaps back ""off"" when the drag returns to the ~40% mark (which is 20% start position + 20% reverse threshold).

The latest change adds the constants `_kDragCommitThreshold` (0.7) and `_kDragReverseThreshold` (0.2) to control this behavior.

The comparison demo repository is available here: https://github.com/ksokolovskyi/cupertino_switch_comparison"
LGTM. Requesting a review from others who have worked on `CupertinoSwitch` sometime in the past.
Commit queue failed; closing this roll.
This appears out of date. Next time please apply the autosubmit label! Thanks!
The bot doesn't auto-submit?
Not without the label AFAIK
"An existing Git SHA, `d992597789036d7df57209221386235cc1305d7c`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"An existing Git SHA, `a956ca883b8e8c84f803cc3dc8da661c9ad9106b`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"> Thank you for taking the time to put together this contribution. Unfortunately we cannot accept a change which regresses the verification status of these input events.

You can read more about verification of input events here. 
https://developer.android.com/reference/android/hardware/input/InputManager#verifyInputEvent%28android.view.InputEvent%29"
"@gmackall Could you please re-run the failing checks? They appear to be flaky.

[Linux linux_web_engine_tests](https://github.com/flutter/flutter/pull/177572/checks?check_run_id=53927644647) Failing after 33m
[Linux web_long_running_tests_5_5](https://github.com/flutter/flutter/pull/177572/checks?check_run_id=53927622208) Failing after 10m
"
"Spoke with @reidbaker offline, going to land https://github.com/flutter/flutter/pull/177804 first and then we should be able to land this"
"Sorry for the delay here, been having some trouble getting the integration test to run properly on our CI. I believe I have narrowed it down to a mismatch in ADB versions, so it should hopefully be fixed shortly by https://github.com/flutter/flutter/pull/178018"
@gmackall Thanks for your effort! Hope all tests pass.
"Will need one more approval before it can land, requested additional reviewers"
@bkonyi Let me know if you have any better ideas for this. This is a hacky workaround because I couldn't figure out why the `stdout` stream isn't receiving the expected logs (see PR description)
"I don't have any better ideas, unfortunately. Maybe @chingjun or @helin24 will have some idea since this is apparently a Cider-V specific issue."
Hmm that's strange! I don't know enough about the flutter tooling to have any theories about why this may be. Thanks for addressing the issue though.
"Just wanted to add a brief note on the pr for context.

The ""Look Up"" action originates entirely from the native iOS side, which created a race condition that made a framework-level (Dart) fix difficult. Early attempts to solve this included:

- Asynchronous Dart call: We tried making the ""Look Up"" call asynchronous and await-ing its completion.
- Native Notification: We tried broadcasting a native NSNotification from the FlutterPlatformPlugin for the FlutterTextInputPlugin to listen to.

Both approaches failed for the same core reason: the iOS operating system calls resignFirstResponder immediately when the ""Look Up"" view is presented, tearing down the text connection before any asynchronous logic or cross-plugin notification could effectively intercept it.

The tradeoff: The solution's main tradeoff is its dependency on the current presentation behavior of iOS's native look-up view. While it's unlikely Apple will alter this fundamental view controller lifecycle, any future OS updates could potentially require this fix to be revisited.
I believe this is a worthwhile tradeoff as it provides a vastly improved, seamless user experience that aligns with the behavior of native iOS applications."
"Greetings from stale PR triage! üëã 
Is this change still on your radar?"
"Greetings from stale PR triage! üëã 
Is this change still on your radar?"
This appears out of date.
"Closing to retry - pub roller has not landed in a month, will shepherd the next one."
"@victorsanni 

Thanks a lot for the review and the thoughtful feedback üôè

Even if it‚Äôs more of a side effect, OrientationBuilder reacts to layout constraints (width vs height), which fits responsive design use cases. On the other hand, DeviceOrientationBuilder uses MediaQuery.orientationOf() to reflect the actual device orientation, which is important on foldable devices or when the layout ratio no longer matches the device state.

I wanted to keep these responsibilities clear ‚Äî layout-driven vs. device-driven ‚Äî rather than mix them in one widget.

That said, if we want to make OrientationBuilder itself more semantically correct (or allow it to explicitly choose its orientation source), then I agree it could make sense to integrate this change directly there. If that‚Äôs the direction you‚Äôd prefer, I can update the PR right away.
"
"@justinmc @victorsanni 
Thank you! I've fixed it."
"Is additional documentation needed?

Personally, I believe clearly documenting these differences in OrientationBuilder behavior should suffice."
Commit queue failed; closing this roll.
Closing in favor of: https://github.com/flutter/flutter/pull/178256
"This PR is waiting on some updated platform independent tests, and will land after those are landed."
"I am pretty sure something will be broken, just that we don't have good semantics test coverage on this part. will add more test.

@jonahwilliams would like to get your opinion first to see if this is something we should do"
"Sorry I missed this completely. I'm not certain why we _wouldn't_ do this, though I admit I haven't looked at this code in a while"
"> Sorry I missed this completely. I'm not certain why we _wouldn't_ do this, though I admit I haven't looked at this code in a while

Agree, will ping again after appropriate tests are added"
@chunhtai Do you need a new reviewer here?
"This is not yet ready, I will try to get to this pr soon"
"> but do we have stats for how long it usually takes to flushSemantics without cache (bench_material3_semantics

I don't think this would be too risky as this is a one time thing, and without this PR the delay will just be on the next frame instead of the current frame. "
Yeah 3ms (as indicated by the web benchmark) when the user turns a11y on doesn't sound too bad. But I'm curious if there's an issue for this / is there a way to experience the current a11y delay myself?
"If not now, the delay it would be on the next frame without this change. in terms of talkback reaction time, it is already bad when the talkback turns on, it usually take some seconds before it start polling for ANI.

My local testing is actually smoother with this change. My guess is a slight delay and return synchrnously is better than return empty ANI first and waiting for talkback's next polling"
@chunhtai Heads up you have some failures here.
Commit queue failed; closing this roll.
"I changed the code to check only the scheme of current flavor, so that the slow build config generation is only executed for current flavor. the build config generation is slow as much as real build, so we must remove useless generation."
Removed unrequired loop
from triage: @vashworth could you take a look since you also reviewed https://github.com/flutter/flutter/pull/172436?
"It appears that this PR checks for `WKCompanionAppBundleIdentifier` within the build settings of the default scheme. However, this does not makes sense as `WKCompanionAppBundleIdentifier` should be set in the companion Watch app's settings, not the iOS app target settings: https://developer.apple.com/documentation/bundleresources/information-property-list/wkcompanionappbundleidentifier?language=objc#Discussion

@garrettjavalia Did this solution not work for you? https://github.com/flutter/flutter/pull/172436"
"I did not test solution in #172436. My solution was made separately from that, and I see that solution is currently closed.

please let me explain about this more.

first of all, checking default(currently targeting) scheme is a valid operation in my opinion.
schemes can include multiple build targets(the apps) and build configurations to use on each operation(debug run, build, etc.)
Imagine a valid Xcode scheme which includes two targets(a host iOS app and a companion watchOS app.) for archive.(which flutter build command should handle, in real world senarios.)
(we surely can omit watchOS app in the scheme we want to use in flutter run command, but not for the flutter build command.)

the second part, which you might feel this code is wrong is, How it can work if it just processes xcode build configuration without specifying correct watchOS app as target. (buildSettingsForBuildInfo function and it`s call chain can specify a target to test, but current code doesn't specify one.)
by running flutter run -v, we can see that if no target is given, it generates config for all targets in the scheme at once.
and it surely includes INFOPLIST_KEY_WKCompanionAppBundleIdentifier if the scheme has watchOS app which is correctly configured by xcode project's target build settings.

now we can think that the valid way to handle this problem might be by making it check only watchOS App's build configuration, and yes that is a valid point. but that is for some cases when a scheme has two or more watchOS app(like one for companion app and one for independent app, or just two companion watchOS apps in wrong configuration.)

with above inspections, I suggest current PR a pretty good way to solve current situation. well, maybe I can improve the code to handle more complicated situations I mentioned above, but it would be optional for now. + I found that checking multiple schemes slow down the flutter run command a lot due to slow build config generation which is also mentioned in some code comments.
```
      // showBuildSettings is reported to occasionally timeout. Here, we give it
      // a lot of wiggle room (locally on Flutter Gallery, this takes ~1s).
      // When there is a timeout, we retry once.
```"
"I tried the #172436 and it worked but it checked different scheme.(my xcode project has a watchApp only scheme which is just used to run watchos app in simulator, So it has same INFOPLIST_KEY_WKCompanionAppBundleIdentifier value with the iOS app which is used by flutter run.)
So I think this is false positive."
"Adding screenshot of valid xcode targer configurations of my project for your information.
<img width=""1118"" height=""957"" alt=""·Ñâ·Ö≥·Ñè·Ö≥·ÑÖ·Öµ·Ü´·Ñâ·Ö£·Ü∫ 2025-10-24 ·Ñã·Ö©·Ñå·Ö•·Ü´ 5 26 57"" src=""https://github.com/user-attachments/assets/3762304b-eee4-41a9-8088-df98108d4532"" />
<img width=""1164"" height=""866"" alt=""·Ñâ·Ö≥·Ñè·Ö≥·ÑÖ·Öµ·Ü´·Ñâ·Ö£·Ü∫ 2025-10-24 ·Ñã·Ö©·Ñå·Ö•·Ü´ 5 28 27"" src=""https://github.com/user-attachments/assets/1463f869-a15a-4d57-87c8-7dc9468d880c"" />
"
"Following screenshot shows how a scheme can have multiple apps in it's scheme configuration of xcode.
<img width=""954"" height=""516"" alt=""·Ñâ·Ö≥·Ñè·Ö≥·ÑÖ·Öµ·Ü´·Ñâ·Ö£·Ü∫ 2025-10-25 ·Ñã·Ö©·Ñí·ÖÆ 6 45 32"" src=""https://github.com/user-attachments/assets/fe8db423-b97f-4a83-8cb2-bcbb869c24be"" />

And this shows how a host iOS app handles it's companion watchOS app during the build phases.
<img width=""1100"" height=""935"" alt=""·Ñâ·Ö≥·Ñè·Ö≥·ÑÖ·Öµ·Ü´·Ñâ·Ö£·Ü∫ 2025-10-25 ·Ñã·Ö©·Ñí·ÖÆ 6 47 15"" src=""https://github.com/user-attachments/assets/d4471931-db57-4f8b-8024-fb4f989434b5"" />

So in short, Xcode project scheme != Xcode build target(app)"
"~~Do you not have a scheme for just the Watch app too?~~

Nevermind, I just saw this comment:

> I tried the https://github.com/flutter/flutter/pull/172436 and it worked but it checked different scheme.(my xcode project has a watchApp only scheme which is just used to run watchos app in simulator, So it has same INFOPLIST_KEY_WKCompanionAppBundleIdentifier value with the iOS app which is used by flutter run.)
So I think this is false positive.

The purpose of loop through of schemes that you're trying to change is to find the watchApp only scheme to find the INFOPLIST_KEY_WKCompanionAppBundleIdentifier, so I think it's an accurate positive? "
"The target dependency and copying steps added on the host iOS app are not something i've invented, it's default behavior of Xcode when you add a watch companion app to a flutter generated iOS app project. isn't it better following convention of Xcode and other iOS apps in the world so that developers can use their contextual information for the similar works?

~~People on #160622 and myself did not make it to fix our project in the way that you've intended. instead, I had to spent whole night to find out what is happening.~~ current code is blocking intended scheme pair solution. I got confused of it, sorry.

~~Furthermore, forcing watchOS app to be built by it's own scheme will force developers somehow tweak their host iOS app's build command to rely on another scheme's build output, which will be not so good in my opinion. (running xcode build command inside a xcode build script or in a comprehensive and independent flutter-build.sh script?)~~ This is also invalid statement, for the host iOS app can be built correctly with the double scheme solution without additional tweak."
"Sorry, I guess maybe I'm misunderstanding something...

If we look at the current logic, it gets all the schemes and then gets the build settings for each scheme (except the default). If the scheme has `INFOPLIST_KEY_WKCompanionAppBundleIdentifier`, it returns true if it matches the `bundleIdentifier`.

https://github.com/flutter/flutter/blob/f4d77a17bbad353cb4e747f17e3f7098133f9f2f/packages/flutter_tools/lib/src/xcode_project.dart#L746-L775

If I understand correctly, you think it should check the default scheme because the default scheme may be building multiple targets, one of which may be the watch target. Correct?

However, one of the schemes should also be the watchApp only scheme. So it should be finding that scheme and returning true. It's not building that scheme - it's only using the scheme to determine if there is a watch companion app. I think the problem people are having is that it's failing when it tries to get the watch scheme's build settings as I explain [here](https://github.com/flutter/flutter/pull/172436#issuecomment-3140433428).

Does that makes sense or am I stilling missing something?"
"Thank you for considering my opinion/comments many times even it doesn't seems quite right at the first look. I really appreciate your effort. I tried to fix my own confusions and clear out the two possible solutions below.


""If I understand correctly, you think it should check the default scheme because the default scheme may be building multiple targets, one of which may be the watch target. Correct?""
- Yes, that is my opinion and most important point of this PR.


I checked deviceId solution again throughly. and found that it solves slow startup problem.(which is not existing in my solution, too. it exists only in current flutter build chain.) xcode's slow build config generation was fixed by not specifying deviceId.
and I found that deviceId solution doesn't need a tweak on host iOS app to make a correct archive. Sorry for invalid information.


You mentioned that a Xcode project with companion watchOS app should have a dedicated scheme only having that watchOS app as target. The answer could be ""almost certain."", not always.
- When you add a companion watchOS app, Xcode generates dedicated scheme, while editing host iOS app's target build phases to support bundling of watchOS companion app within it
(We have a documentation about the structure. https://developer.apple.com/documentation/bundleresources/placing-content-in-a-bundle as a support that we need to bundle watchOS app in the host iOS app. you can check the last part of the table.)
- So, yes it is almost certain that we will have/keep dedicated scheme but we have to assume that developers are having dedicated watchOS app scheme which is matching with iOS host app bundle id variation. (I have all the dedicated schemes for all variations, but this is something good to do for development, not mandatory.)


things can be wrapped up like below :
1. use solution ""remove deviceId on check but rely on dedicated scheme"" : it requires pair schemes of host iOS and watchOS app  are correctly configured. If not, host iOS app will fail to run or build because it forces embedded watchOS app to be built for iOS, not watchOS. (check original PR of mine for description)
2. use solution ""check only current scheme(default scheme) if they have watch companion app with them."" : correctly configuring current scheme is all you need.

what I think is option 2 is better."
"How about as a comprise we do both? We change it to so that it will check the default scheme but it will also check the other schemes for the watch-only scheme?

```diff
final String? defaultScheme = projectInfo.schemeFor(buildInfo); 
   if (defaultScheme == null) { 
     projectInfo.reportFlavorNotFoundAndExit(); 
   } 
   for (final String scheme in projectInfo.schemes) { 
-     // the default scheme should not be a watch scheme, so skip it 
-     if (scheme == defaultScheme) { 
-       continue; 
-     } 
     final Map<String, String>? allBuildSettings = await buildSettingsForBuildInfo( 
       buildInfo, 
-       deviceId: deviceId, 
       scheme: scheme, 
       isWatch: true, 
     ); 
     if (allBuildSettings != null) { 
       final String? fromBuild = allBuildSettings['INFOPLIST_KEY_WKCompanionAppBundleIdentifier']; 
       if (bundleIdentifier == fromBuild) { 
         return true; 
       } 
       if (fromBuild != null && fromBuild.contains(r'$')) { 
         final String substitutedVariable = substituteXcodeVariables(fromBuild, allBuildSettings); 
         if (substitutedVariable == bundleIdentifier) { 
           return true; 
         } 
       } 
     } 
   } 
   return false; 
 } 
 ```"
"Ok, I considered benefits of your merged approach, it seems it can handle some miss configured projects which can be produced in following steps.

1. add multiple watch companion app targets to default scheme as build targets.
2. some of those watch companion apps have wrong WKCompanionAppBundleIdentifier.
3. because ""parseXcodeBuildSettings"" can handle only the latest value on the config output string, flutter can possibly fail on detecting correctly configured watch companion app with matching WKCompanionAppBundleIdentifier.
4. the app build output still can work fine if the companion app with wrong WKCompanionAppBundleIdentifier is not included in the host iOS app's ""embed watch content"" build step.

(I have no idea what will happen if we actually include the wrong watch companion app in the iOS app bundle. neither for the case that multiple watch companion app is actually included in the iOS app.)

So, I guess it will be good to write a defensive and robust logic.

I agree with your solution and I will edit this PR to have latest flutter branch file and update it."
"Great! I'm glad you agree!

Can you ensure all tests in [test/general.shard/project_test.dart](https://github.com/flutter/flutter/blob/master/packages/flutter_tools/test/general.shard/project_test.dart) pass and add an additional test that uses the default scheme?"
Updated existing tests and added new tests as a separated test group.
"current test codes related to watch companion app seems to have some ineffective codes.
test codes are mocking buildSettingsByBuildContext by using 
`mockXcodeProjectInterpreter.buildSettingsByBuildContext[buildContext]`
but the actual code is suspicious of getting bundle idendifier from plist mock ups. 
I cannot tell with 100% correctness because I cannot run these tests in local yet.
I will try to remove those ineffective test codes, but even now it works in cost of confusing developers(like me)"
"found out that 'watch companion' test group's test codes are getting host iOS app bundle name configuration with XcodeProjectBuildContext(scheme: 'Runner')
while it requires XcodeProjectBuildContext(scheme: 'Runner',  deviceId: '123' ) for substituteXcodeVariables calls used to parse PList file.

refactored test codes in following ways.
1. Removed ineffective configurations related to substituteXcodeVariables in test cases those are not interacting with plist xcode variable.
2. unified code that sets bundle id into the 'watch companion' test group, which were divided into sub testgroups in my previous commit."
"I found that multi target schemes are Ok in xcode, but not in flutter code.
productBundleIdentifier function in xcode_project.dart is weak to multiple targets so that it can detect wrong bundle identifier.
It was pure luck that my xcode project was working fine in flutter run and flutter build command.
I will think of improvement to this. until then, I guess this PR should be draft "
"I had to rollback code to something identical to #172436 

Detection of watch companion app without dedicated watch app target scheme requires watch companion app target included as a explicit build target of the default scheme.
however, it causes malfunctioning of bundle identifier detection logic of flutter ios build chain.
because the existing logics of flutter ios build chain assumes default scheme will have only one explicit build target which generates it's build configuration output for xcodebuild command.

I don't think changing the entire flow just for watch companion app will give us any visible benefit for now.
It should be some high level redesign of flutter/ios integration."
@loic-sharma could you review this updated PR ?
"@loic-peron-inetum-public Thanks for the pull request!

I'm a little concerned that this change might regress Flutter Windows's accessibility support in unexpected ways as a similar change to add UI Automation had caused unexpected problems.

Could you include details on how you verified this change? What scenarios did you test?"
"Regarding how we use and tests this proposal:

We are building an application targeting iOS and Windows. We automate black-box tests using Appium on both platform. We use a [custom build of the flutter engine for Windows that includes the required PR to get Semantics::identifer to be exposed as AutomationId](https://github.com/inetum/flutter-engine-windows-automationid). The application is not evaluated on its accessibility for actual users.

Regarding UI Automation-related regressions:

I understand that switching to UI Automation required a full switch in the accessibility interface exposed by Flutter. It seems that IAccessibleEx is a way to extend IAccessible-based exposition with the additional capabilities offered by UI Automation, without jeopardizing existing baheviours.

What are the unexpected ways that triggered unexpected problems and regressed Flutter accessibility support during a previous attempt to switch to UI Automation ? How can I check them ?"
"> What are the unexpected ways that triggered unexpected problems and regressed Flutter accessibility support during a previous attempt to switch to UI Automation ? How can I check them ?

I would manually check that a sample Flutter Windows app still works well with JAWS, NVDA, and Windows Narrator. I'd make sure that as you tab around, the screen reader properly announces content, without any differences compared to today's implementation.

----

Could we de-risk this by making the `IAccessibleEx` implementation opt-in at runtime?

Flutter Windows's API has a `DartProject` that lets you configure your Flutter app. For example, you can configure which threads the apps uses (see [this](https://github.com/flutter/flutter/blob/ceaac22da1a1558eb623d95ba81afd7aa349d9e0/engine/src/flutter/shell/platform/windows/client_wrapper/include/flutter/dart_project.h#L104-L107) and [this](https://github.com/flutter/flutter/blob/ceaac22da1a1558eb623d95ba81afd7aa349d9e0/engine/src/flutter/shell/platform/windows/client_wrapper/include/flutter/dart_project.h#L23-L32)).

Could we update `QueryService` to only return an `IAccessibleEx` interface if the Flutter app turned on the `IAccessibleEx` feature?

Here's what this API might look like:

```cpp
// Configures the accessibility implementation used by Flutter.
enum class AccessibilityMode {
  // Default value. Flutter will automatically select the best available
  // implementation.
  Default,
  // Use the IAccessible implementation.
  IAccessible,
  // Use the experimental IAccessibleEx implementation.
  IAccessibleEx,
};

class DartProject {
  // Sets the accessibility implementation used by Flutter.
  void set_accessibility_mode(AccessibilityMode accessibility_mode) {
    accessibility_mode_ = accessibility_mode;
  }
}
```

To opt-in to the `IAccessibilityEx` implementation, the app developer would need to modify their `windows/runner/main.cpp` file:

```cpp
flutter::DartProject project(L""data"");
project.set_accessibility_mode(flutter::AccessibilityMode::IAccessibleEx);
```

Then, `QueryService` would only return an `IAccessibleEx` interface if the app opted-in to `AccessibilityMode::IAccessibleEx`. What do you think of this approach?"
Note to self: these docs are an excellent resource to review this PR: https://learn.microsoft.com/en-us/windows/win32/winauto/implementing-iaccessibleex-for-providers
"> Could we de-risk this by making the `IAccessibleEx` implementation opt-in at runtime?

I will try and implement an engine-runtime configuration option in november.

Could this be enabled using an application-buildtime `--dart-define=` property ?"
"> Could this be enabled using an application-buildtime `--dart-define=` property ?

Sadly, no. The Windows embedder doesn't have an easy way to read Dart defines. The suggestion I left above means that the app developer will need to update the C++ code in their Flutter Windows entry point ([example](https://github.com/flutter/flutter/blob/865f4431bd3d9bb450d55475faed2cca78a6fac1/examples/api/windows/runner/main.cpp#L24))."
Is progress still being made on this?
No idea why Google testing is hanging but otherwise looking good from my side
@bkonyi You labeled the referenced issue as still valid. Are you interested in reviewing this PR? 
The team isn't planning to build 3.35 again so closing.
Will fix #178178 once landed / rebased.
"An existing Git SHA, `d7fc5ae7e507436f13bbcaae4ed9064cf8d6b20f`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"Note: I took a look at the few failing macOS CI steps but after digging into LUCI and the raw outputs, I couldn't quite fine anything connected to this PR, but I might have missed something! Please let me know if there are any specific pointers I could look for and I'd be happy to fix any issues."
@Renzo-Olivares hey wondering if you were able to take a look; thank you so much! üôè 
"Hi @luanpotter, thank you for your patience and this contribution! I will take a look this week."
" @vashworth please fill out the PR description above, afterwards the release team will review this request."
Closing in favor of https://github.com/flutter/flutter/pull/178243.
" @vashworth please fill out the PR description above, afterwards the release team will review this request."
Closing in favor of https://github.com/flutter/flutter/pull/178244.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"The codec failures are real. They can be reproduced by simply opening this page in Chrome: https://github.com/google/skia/blob/main/resources/images/interlaced-multiframe-with-blending.png (wait a few seconds to see the window crash).

Alternatively, here's a jsfiddle that showcases the bug: https://jsfiddle.net/mdebbar/cLbwfeu1/3/"
AutoRoller is stopped; closing the active roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
CLA signed
"## CI Status Follow-up

I see the `ci.yaml validation` check is failing. Since this PR only modifies:
- `packages/flutter_tools/lib/src/ios/code_signing.dart` (logging logic)
- `packages/flutter_tools/test/general.shard/ios/code_signing_test.dart` (unit test)

This appears unrelated to ci.yaml configuration. Could the maintainers please review the ci.yaml failure to determine if it's a check issue or requires action on my end?

All other checks (CLA, code review) are passing. The fix is minimal, focused, and includes test coverage."
Commit queue failed; closing this roll.
"@LouiseHsu I should stop reviewing this until you mark this as not a draft and ready for review, sorry about that üôÇ "
"@jmagman my bad, I totally forgot to put this into review mode. Thank you for the reviews!
"
"@LouiseHsu Can you fill out the description with the details of this change? Why did you have to touch schemes, how to test it, for example.  

Additionally ""Allow runner rename"" is not a very descriptive commit title since anyone unfamiliar with the problem will have no idea what it means. Something like ""Allow iOS and macOS Xcode project to be renamable from default Runner"" would be better

You can also include ""Fixes https://github.com/flutter/flutter/issues/9767"" and the ""fixes"" part will close that issue when this PR closes."
"> 3. In the right panel, the name of the project, ""Runner"", should be visible under ""Identity and Type"". Change the name and press enter.

Can also just select the project on the navigation tab on the left, hit enter, and type the new name. "
"> Tests for schemeFor were changed as with Xcode 14, in some cases the scheme will be renamed along with the project. 

I think we can also instruct people to rename the scheme. Or ask them to rebuild the iOS project, which should update to the new scheme name. "
"I renamed a bunch of my personal projects before. I think we should also rename the folder `ios/Runner/class_files`, and also update `Info.plist` path after that (but maybe flutter build already have that step covered)"
"> I think we can also instruct people to rename the scheme. Or ask them to rebuild the iOS project, which should update to the new scheme name.

> I renamed a bunch of my personal projects before. I think we should also rename the folder `ios/Runner/class_files`, and also update `Info.plist` path after that (but maybe flutter build already have that step covered)

I think the point of this issue is that we need to handle any combination of renames that Xcode allows, not assume the name of the project or workspace.  If it works from Xcode it should work from `flutter`.  Users should be allowed to just rename the project or workspace, or name them different things, as they choose.  The `Runner` directory is trickier, but we can figure that out in another PR."
"In fact I think these should be addressed separately, if at all. 
1. The xcodeproj or xcworkspace is renamed, maybe not the same.  This is trivial to detect by the extension and was the only thing I considered in scope to this PR.
2. The scheme is also renamed.  We already handle schemes with flavors and I would wait until we get any feedback from users that they want to rename their default project scheme without using flavors.
3. They want to rename their `ios/Runner` directory.  This would would be much trickier since `flutter` generates files to that directory and is opinionated about what's in there.   I don't think I've seen any case of a user requesting that and if they did it sounds like a P6.

Let's narrow the scope of this to 1: The xcodeproj or xcworkspace is renamed.  That's it, not the scheme, not the directory."
"> Additionally ""Allow runner rename"" is not a very descriptive commit title since anyone unfamiliar with the problem will have no idea what it means. Something like ""Allow iOS and macOS Xcode project to be renamable from default Runner"" would be better
> 
> You can also include ""Fixes #9767"" and the ""fixes"" part will close that issue when this PR closes.

Bump these two comments as well üôÇ "
"Testing out this change with the latest version of Flutter.

Initially, without any additional pods installed, the name change functions correctly.
Once Flutter generates the Podfile the build fails because it's still looking for `Runner.xcodeproj`.

```
Launching lib/main.dart on iPhone 14 Pro Max in debug mode...
main.dart:1
CocoaPods' output:
‚Ü≥
      Preparing
    Analyzing dependencies
    Inspecting targets to integrate
    [!] Unable to find the Xcode project `/{pathtoproject}/ios/Runner.xcodeproj` for the target `Pods-Runner`.
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/installer/analyzer/target_inspector.rb:68:in `compute_project_path'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/installer/analyzer.rb:1193:in `each'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/installer/analyzer.rb:1193:in `group_by'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/installer/analyzer.rb:1193:in `block in inspect_targets_to_integrate'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/user_interface.rb:64:in `section'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/installer/analyzer.rb:1188:in `inspect_targets_to_integrate'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/installer/analyzer.rb:107:in `analyze'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/installer.rb:422:in `analyze'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/installer.rb:244:in `block in resolve_dependencies'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/user_interface.rb:64:in `section'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/installer.rb:243:in `resolve_dependencies'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/installer.rb:162:in `install!'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/command/install.rb:52:in `run'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/claide-1.1.0/lib/claide/command.rb:334:in `run'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/lib/cocoapods/command.rb:52:in `run'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/gems/cocoapods-1.12.1/bin/pod:55:in `<top (required)>'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/bin/pod:25:in `load'
    /opt/homebrew/Cellar/cocoapods/1.12.1/libexec/bin/pod:25:in `<main>'
Error running pod install
Error launching application on iPhone 14 Pro Max.
Exited
```

After updating the Podfile, as well as the xcconfig files with the new project name it all functions correctly.

`Podfile`
```
project 'TestName', {
  'Debug' => :debug,
  'Profile' => :release,
  'Release' => :release,
}

target 'TestName' do
  use_frameworks!
  use_modular_headers!

  flutter_install_all_ios_pods File.dirname(File.realpath(__FILE__))

  target 'TestNameTests' do
    inherit! :search_paths
  end
end
```

`ios/Flutter/Debug.xcconfig`
```
#include? ""Pods/Target Support Files/Pods-TestName/Pods-TestName.debug.xcconfig""
#include ""Generated.xcconfig""
```

`ios/Flutter/Release.xcconfig`
```
#include? ""Pods/Target Support Files/Pods-TestName/Pods-TestName.release.xcconfig""
#include ""Generated.xcconfig""
```"
@LouiseHsu @jmagman I think we need flutter command for this
Commit queue failed; closing this roll.
"An existing Git SHA, `4b5067968f0a054bca27f40585b17b9b12164cbb`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
Commit queue failed; closing this roll.
"This kind of goes against https://github.com/flutter/flutter/issues/99749 and https://github.com/flutter/flutter/pull/100251. I'm opening this PR to start the discussion

cc @StraussPorcupine @LongCatIsLooong @justinmc since it is your issue/PR/review"
"I understand, the thing is that our users are expecting to see the dropdown when they re-focus the field and it brings friction at the moment. 

If we were to merge this PR as it is today. Devs can keep the existing behavior by returning an empty iterable when an option is selected. When that's the case, the menu doesn't show. 

‚ÄãThis PR gives developers more control and flexibility to customize this behavior. I'm open to any suggestions for a cleaner implementation or a solid migration plan if you have a better approach!"
"I fixed the PR locally and tested the issue in https://github.com/flutter/flutter/issues/99749 and it resurfaces with this PR:


https://github.com/user-attachments/assets/74d4a51d-a75d-4a7c-a177-ac8817ea8e42

> If we were to merge this PR as it is today. Devs can keep the existing behavior by returning an empty iterable when an option is selected. When that's the case, the menu doesn't show.

I don't think we want to break users even with this workaround. Communicating the workaround will be difficult, and the breakage is a lot of friction in itself.

Is there a solution that just opens the options view whenever the field is focused? There has to be a solution that fixes this issue and keeps the behavior of https://github.com/flutter/flutter/issues/99749 without broadening the API surface. Or do you think this is impossible?"
"> Do you mean return an empty iterable in optionsBuilder?

@justinmc yes this is what I was suggesting"
"> It seems to me like most users will want the current behavior., or do you not think so @ValentinVignal?

I'm having a fair amount of friction today with my users that expect the menu to open when they focus the field.
Let me try to investigate more to see if I can make it non breaking and still support https://github.com/flutter/flutter/issues/99749"
"@victorsanni @justinmc, what do you think of the current code? It hides the menu after selection, but allows the user to reopen it when refocusing it


https://github.com/user-attachments/assets/a5b9ee98-84d0-443b-979f-0e2efe88a13d

"
@ValentinVignal Can you try updating with master to get the Google tests to run? It looks like they're stuck.
"@victorsanni 

> Can we document this new behavior somewhere? For posterity. Even if only private docs.

I added [Add comments](https://github.com/flutter/flutter/pull/177705/commits/9b1e48cf4c569fb49013591ce39742a55a62aae4), tell me what you think about it :)

> Can you also test locally in different scenarios that this doesn't cause any weird bugs? e.g with debouncing.

Nice catch! There was indeed an issue with debouncing. When a value was selected, and the field refocused to the display the options, the menu was showing the previously fetched options without refetchings the new ones based on the new text in the text field [Fix debouncing](https://github.com/flutter/flutter/pull/177705/commits/4ab2ca803731f2c41113e85475cf8e07d56d2b6a) should fix it. I'm not sure you'll like the solution though


https://github.com/user-attachments/assets/0fbb37be-c123-421e-ad5b-560610b488d4


"
Pushing a merge commit since the tree was just fixed.
@justinmc @victorsanni it looks like the Google testing failed :( Would you have any details about it?
"> it looks like the Google testing failed :( Would you have any details about it?

Failures seem legitimate. I will look into it and provide more details."
"An existing Git SHA, `95effe71f0d39938245599ce556a57ca004fa70e`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
" Not sure about the ""existing Git SHA"" thing. I'll recreate the PR."
Commit queue failed; closing this roll.
"An existing Git SHA, `82b41081008f916212756358ad39eb096e1f7da5`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"> > applies paragraph spacing (margin-bottom) by wrapping its contents with a bottom Padding.
> 
> Will this handle cases where developer use \n\n to generate paragraph within a single text widget? or is this something that we don't care about?

I want to say we don't really care about that case since the web doesn't seem to properly handle that case either. The extensions and bookmarklet's i've tried only apply ""paragraphSpacing"" between ""p"" elements."
These things seem to do overriding similar to `AccessibilityFeature.boldText` and I suspect people will have similar complains: https://github.com/flutter/flutter/issues/139712. 
"> These things seem to do overriding similar to `AccessibilityFeature.boldText` and I suspect people will have similar complains: #139712.

That's definitely a concern, though I feel like with regards to accessibility, if you are using an extension who's intention is to apply a specific specification, for example WCAG https://www.w3.org/TR/WCAG21/ , then it is reasonable that is overrides any application defaults.

I tested out what the web does in this scenario by setting some large number for letter-spacing to some text, and enabling text spacing settings through an extension, it ends up overriding the default letter-spacing that I set."
"> left some comments. Also, this should be disabled in `Icon`. The paragraph spacing should be disabled in a `WidgetSpan`.

Thanks for calling this out, `Icon` should be okay since it uses `RichText` and `RichText` does not inherit these values. Disabling this for `WidgetSpan` definitely sounds reasonable."
"After talking offline with @loic-sharma I think we should leave the framework automatically applying `paragraphSpacing` to its text widgets out of this PR. I plan to explore some options we can take for this in a design doc.

Concerns:
- If this feature is opt-out from the start then users may experience unexpected behavior (such as clipping) when enabling a text spacing extension or bookmarklet because the paragraph spacing is applied to all text across all components, this includes headers, navigation bar destinations, tab destinations, badges, buttons, and other ui components where it may be better to always have paragraph spacing disabled. On the framework side we can disable it for all the components we own, but it's likely that flutter users have used the `Text`/ or `SelectableText` widgets in their own custom components so they will also be broken.

Changes since last review:
- `paragraphSpacing` -> `paragraphSpacingOverride`, and the value is now nullable. This change was made to support the the use-case where if the framework does end up implementing default paragraph spacing, a user can still request it to be 0.0 overriding the default value. If this remained non-nullable the framework would not be able to differentiate between 0.0 set by the user and 0.0 the default.
- The framework no longer automatically applies `paragraphSpacingOverride` to its text but the value is still accessible through `MediaQuery`."
Closing this in favor of https://github.com/flutter/flutter/pull/178081
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Non blocking: is it possible to add a regression test for this case? 
"> Non blocking: is it possible to add a regression test for this case?

It doesn't look like it'll be trivial without some refactoring of our `FakeProcessManager` and related classes."
"An existing Git SHA, `78430bf36b150bbcfd05cf482828fc9967e71276`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"Why web-define instead of dart-define ? Using dart define seems more consistent.

Also does this support only index.html or other files too (manifest etc) ?  "
"> Why web-define instead of dart-define ? Using dart define seems more consistent.
> 
> Also does this support only index.html or other files too (manifest etc) ?

Is dart define possible to use in index.html as template? Where I can found this usage? I search a lot and dont found any information like that.

---

My propose is to use it to dynamically provide resources to web flutter app in build and devlop time."
"Why don't you call it:
Add --web-define for flavors injection in Flutter web builds?"
"> Why don't you call it: Add --web-define for flavors injection in Flutter web builds?

Why it will help not only in flavor, althogh it will be the more blessed fro this feature.

Maybe the mix of template variable and flavors injection should emerge a goot title for this PR."
you should request a review
"An existing Git SHA, `dca7a559fba71ed29693561ad7c09e7229a6934a`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"An existing Git SHA, `dca7a559fba71ed29693561ad7c09e7229a6934a`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"> > Why web-define instead of dart-define ? Using dart define seems more consistent.
> > Also does this support only index.html or other files too (manifest etc) ?
> 
> Is dart define possible to use in index.html as template? Where I can found this usage? I search a lot and dont found any information like that.
> 
> My propose is to use it to dynamically provide resources to web flutter app in build and devlop time.

I was asking whether using --web-define flag, instead of an existing --dart-define was the way to go. `--dart-define` doesn't do anything in the html."
"> I was asking whether using --web-define flag, instead of an existing --dart-define was the way to go. `--dart-define` doesn't do anything in the html.

That's correct. `--dart-define` only provides values to the `*.fromEnvironment(...)` constructors for `String`, `int`, and `bool`.

I do wish that we had used `--define` instead of `--dart-define`, because then we could just use the `--define` option for this web template case as well. However, since that's not the case, `--web-define` sounds reasonable to me."
"
> > > Why web-define instead of dart-define ? Using dart define seems more consistent.
> > > Also does this support only index.html or other files too (manifest etc) ?
> > 
> > 
> > Is dart define possible to use in index.html as template? Where I can found this usage? I search a lot and dont found any information like that.
> > My propose is to use it to dynamically provide resources to web flutter app in build and devlop time.
> 
> I was asking whether using --web-define flag, instead of an existing --dart-define was the way to go. `--dart-define` doesn't do anything in the html.

I understand your point. I chose to introduce a new parameter instead of reusing `--dart-define` because that flag is already heavily used and could cause confusion. Using `--dart-define` for this purpose would also require deeper explanations and tutorials for each environment.

By introducing `--web-define`, we keep the configuration platform-specific and avoid mixing concerns."
"This looks good to me overall!

However, it looks like this has caused a regression that will need to be resolved: https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8698954831552053377/+/u/run_test.dart_for_tool_integration_tests_shard_and_subshard_2_9/stdout"
"> This looks good to me overall!
> 
> However, it looks like this has caused a regression that will need to be resolved: https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8698954831552053377/+/u/run_test.dart_for_tool_integration_tests_shard_and_subshard_2_9/stdout

It was introduced in the last refactor, but I already solve it."
"@ulisseshen thanks for fixing the test failures!

There are still [analysis and formatting issues](https://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8698928662851751393/+/u/run_test.dart_for_analyze_shard_and_subshard_None/stdout) that need to be addressed:
```
Analyzing flutter...                                            

   info ‚Ä¢ Omit the type annotation on a local variable when the type is obvious ‚Ä¢ packages/flutter_tools/lib/src/runner/flutter_command.dart:1632:11 ‚Ä¢ omit_obvious_local_variable_types
   info ‚Ä¢ Omit the type annotation on a local variable when the type is obvious ‚Ä¢ packages/flutter_tools/lib/src/runner/flutter_command.dart:1636:18 ‚Ä¢ omit_obvious_local_variable_types
   info ‚Ä¢ Unnecessary use of parentheses ‚Ä¢ packages/flutter_tools/test/general.shard/web_template_test.dart:485:31 ‚Ä¢ unnecessary_parenthesis
   info ‚Ä¢ Unnecessary use of parentheses ‚Ä¢ packages/flutter_tools/test/general.shard/web_template_test.dart:516:31 ‚Ä¢ unnecessary_parenthesis
   info ‚Ä¢ Unnecessary use of parentheses ‚Ä¢ packages/flutter_tools/test/general.shard/web_template_test.dart:546:31 ‚Ä¢ unnecessary_parenthesis
```
and the following files need to be formatted (using `dart format`):
```
- packages/flutter_tools/test/general.shard/web/devfs_web_test.dart
```"
Commit queue failed; closing this roll.
"> There is still one behavior I would like to discuss. When the showTrailingIcon: true and textInputAction: TextInputAction.previous are used, the focus moves not to the previous field but to the IconButton. If we wrap the IconButton with ExcludeFocus, then this is fixed, but I am not sure whether this is the correct way to proceed.

For reference, see https://github.com/flutter/flutter/issues/174096 which proposed to make the trailing icon not focusable by default.
One way would to completely replace the `IconButton` with a basic Icon. But relying on `ExcludeFocus` seems easier to land in the short term as it will break less tests.
It will probably be better to not wrap the `IconButton` with `ExcludeFocus` in this PR and address it separately as it might break some Google test.

The correct way would probably be to wrap the `IconButton` with `ExcludeFocus` and set `ExcludeFocus.excluding` based on `DroppdownMenu.trailingIconFocusNode` :

````dart
ExcludeFocus(
  // Do not exclude focus if a focus node is explicitly provided.
  excluding: trailingIconFocusNode == null,
```


"
"Hi @justinmc, could you please take a look at this PR when you have time?
Thanks a lot in advance!"
"> Maybe bleroux should take a look as well?

I had a look to this change during our internal review process. But I will discuss with Kostia tomorrow because I'm thinking of some behaviors we have to verify before merging this change."
"An existing Git SHA, `0cbac8ce4d8b795f8f0f73009597358d252bf82f`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
Commit queue failed; closing this roll.
"@tirth-patel-nc Hi!

Who will review this PR?"
"@mboetger @hellohuanlin thanks a lot for your review!
@dkwingsmt, may I ask you to find someone to review the web and framework parts?"
"@ksokolovskyi looks like you have approvals from all platforms, is this ready to land? "
Thanks a lot everyone for the review!
"An existing Git SHA, `7a01f9e517cba39fc283da4664da4abed47aad4f`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"> I think that the real, long-term solution here is to give users more control over when errors are displayed. I have been meaning to work on this myself for years... But given that I haven't gotten around to it, I'm up for adding things like this for realistic use cases that aren't possible today. I think this one qualifies. Thanks for the PR.



Thanks so much for the thoughtful feedback! I completely agree ‚Äî giving users more control over error display timing would definitely make validation more flexible and intuitive. I‚Äôm glad this use case aligns with that direction, and really appreciate your openness to the change.

And will fix the suggested changes,
"
"> Thanks for the fixes! Two main things here: a use of a deprecated member, and some minor suggestions for improving the tests.

Hai I done those fix too, kindly check thank you."
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
"@dkwingsmt Heads up, a somewhat large change to menu item layout will land soon, so you may want to avoid reviewing that section for a day or so."
"> I think we should deprecate this property but only on the separated constructor. And replace with a `ListView.separated.findItemIndexCallback`. Is this possible? What do you think @rkishan516?

Yes, it is possible. I was just worried about `seperated` constructor being inconsistent with others."
cc @chunhtai who might know if we need to preserve the original callback.
"I see no good reason to preserve the original callback. since we don't provide a way to build different separator based on index, and you can't swap a separator's location with other item."
"> change lgtm, but we need a migration guide and follows https://github.com/flutter/flutter/blob/main/docs/contributing/Tree-hygiene.md#handling-breaking-changes

I have added migration guide at https://github.com/flutter/website/pull/12636"
Can you add the migration guide to the PR description so it is easy to find?
"@gmackall - this unit test repros: https://github.com/flutter/flutter/issues/175845

It seems like we still need to add the abiFilters for our platform architectures (so not sure https://github.com/flutter/flutter/pull/177745 is going work), but product flavors are not being respected when we do.  "
"> I think to truly mark the linked issue as fixed we would also need to expose this option through the flutter tool, something like the path that `android-skip-build-dependency-validation` takes in #143341

Technically it can be invoked by the flutter tool though, no?  This is the test invocation I used: 
```
flutter build apk --release --flavor arm64 -Pdisable-abi-filtering=true
```
I thought about adding at `flutter` level command line, but since this is such a niche use case and should only be used at the developers peril I didn't want to make it too easy for developers to find the escape hatch.  I was going to add some documentation on https://docs.flutter.dev/release/breaking-changes/default-abi-filters-android but I was concerned adding a `flutter` level flag would invite users to try it out. 

Anyway, that's my 2 cents.  If it's a blocker to LGTM I'll add it."
"> > I think to truly mark the linked issue as fixed we would also need to expose this option through the flutter tool, something like the path that `android-skip-build-dependency-validation` takes in #143341
> 
> Technically it can be invoked by the flutter tool though, no? This is the test invocation I used:
> 
> ```
> flutter build apk --release --flavor arm64 -Pdisable-abi-filtering=true
> ```
> 
> I thought about adding at `flutter` level command line, but since this is such a niche use case and should only be used at the developers peril I didn't want to make it too easy for developers to find the escape hatch. I was going to add some documentation on https://docs.flutter.dev/release/breaking-changes/default-abi-filters-android but I was concerned adding a `flutter` level flag would invite users to try it out.
> 
> Anyway, that's my 2 cents. If it's a blocker to LGTM I'll add it.

Ah I had forgotten about the `-android-project-arg/-P` command. That's fair, I actually prefer passing it that way as well. 

Maybe we should add something to our [flavors docs](https://docs.flutter.dev/deployment/flavors) which makes brief mention of this requirement when using abiFilters on the product flavors though? Otherwise I think there is essentially no way for a developer to know to do this outside of either us telling them directly on an issue, or them knowing the internals of the FGP (which I think we should never assume they do)."
This was stuck in the merge queue and not progressing; removing and re-inserting.
"> This was stuck in the merge queue and not progressing; removing and re-inserting.

Did you try turning the computer off and then back on again? /s"
Need to add a test. Just checking to see if it passes
"@bkonyi 

```dart
void main() {
  print(Uri(scheme: 'https', host: '::1', port: 8080));

  print(Uri.https('[::1]:8080'));
}
```

The trick: we take the `host` bit separately. It's valid to give the IPv6 host using `[]` but that's weird to do in the host field.

I wish we had better error parsing in this logic, though. The failure is pretty bad."
This is currently blocking the MQ (never scheduled) - removing and re-adding.
"After the change, when ExcludeSemantics in on, the map can't be interacted with using mouse, is this expected? "
"> After the change, when ExcludeSemantics in on, the map can't be interacted with using mouse, is this expected?

it is not expected. let me revisit the issue again."
"An existing Git SHA, `6c5a35b4a4e3190dce113c95c159a1b101eb04c4`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"Hi @Piinks, @justinmc!
I feel like my current implementation left the component in a bad state (which I apologize for), since the ticking sound might be quite unpleasant to headphone users, which might turn some app's users away. 

I don't currently know of an easy way to make the ticking sound follow the native iOS behavior, namely that it does not play the sound at all when headphones are connected, and unfortunately I don't currently have the bandwidth to investigate a proper solution, so the least I could do is add a flag to allow developers to opt-out of the sound. It can be a temporary flag until we find a better solution, or it can stay, maybe there is value in allowing the developer to disable or even customize the sound.

@justinmc good call on the name, I will update it to align with similar parameters. As for also controlling the haptics, I am not sure. On one hand there are similar toggles in other widgets, as you mentioned, on the other hand I think that some developers might still want to have the haptics enabled, but opt-out of the sound, since in it's current state it can be unpleasant to the users.

"
"> until the bug where it plays on full volume on headphones is fixed.

Is this a bug on our side or iOS? We do not usually land temporary workarounds, rather we embrace the yak shave and fix the root issue. :)"
"I agree with Kate that adding this for the purpose of a workaround isn't ideal. But in my opinion, adding it for the sake of customizability like other widgets have sounds good to me."
From triage meeting - @LongCatIsLooong could you comment on the `UIPickerTableView` you mentioned offline? 
I've left some comments in https://github.com/flutter/flutter/issues/174691.
"An existing Git SHA, `d9541b6163d513ac111cc6a0172baa4259786dfb`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
@knopp FYI lots of conflicts on this now.
"There's a ghost (modal) Dialog left if you kill its parent via the trashcan:
<img width=""1306"" height=""691"" alt=""Screenshot 2025-10-28 at 12 01 44"" src=""https://github.com/user-attachments/assets/083366d8-358c-4e74-966f-c5039917d1ed"" />
<img width=""1306"" height=""691"" alt=""Screenshot 2025-10-28 at 12 01 57"" src=""https://github.com/user-attachments/assets/4892bbba-ff0a-42a1-ac99-6be10537a93b"" />
"
@knopp From triage meeting - hi could you fill up the PR description and the checkboxes? 
"Tested this fix in our production app (heavy usage of blurred overlays over platform views). The clipping works perfectly, but we're seeing significant performance impact:

- **Debug builds**: 2-3ms per raster frame (~15-25% slower)
- **Release builds**: 1-2ms per raster frame (~8-15% slower)

Potential optimisations:
- Cache clip layers between frames when geometry is static
- Batch multiple BackdropFilters into a single platform view
- GPU shader-based clipping instead of CALayer composition

Not my domain, so not 100% sure.

Happy to provide profiling data or test optimisation approaches if there's interest.

Test setup: Flutter 3.35.7 baseline vs custom build with this PR, iPhone 16 Pro (iOS 18.6.2)"
"Thank you for testing it out, I had worked on this based off a simple example, happy to iterate to make this performant enough to land. 

>Platform view layer creation for each blur instance on every frame
  

This should be happening in the baseline as well, as my PR is modifying the existing blur's corner radius rather than blurring in a new way. So it's weird if you're seeing that as a difference between baseline and this PR.

Would be great if you can provide profiling data for both baseline on main and against this PR.

Do you have multiple rounded blurs on a platform view or is it like a scrollable of rounded blurs on the platform view? Trying to setup a reproducible sample "
"@LukeMoody01 diving a bit more into the bottlenecks and optimisations you have mentioned - any chance this was AI generated? Because this isn't really making sense to me based off of the code. For example

> No caching when clip geometry hasn't changed.
> Platform view layer creation for each blur instance on every frame

As I understand `@property(nonatomic) NSMutableArray<UIVisualEffectView*>* backdropFilterSubviews;` is storing the filters and those are being reused 
```
if (self.backdropFilterSubviews.count <= index) {
      backdropFilterView = filter.backdropFilterView;
      [self addSubview:backdropFilterView];
      [self.backdropFilterSubviews addObject:backdropFilterView];
    } else {
      [filter updateVisualEffectView:self.backdropFilterSubviews[index]];
    }
```

I did have some stray logs I had added in this PR that I have now removed, can you try rerunning your performance benchmark? I think the perf hit just came from those rather than anything else"
"> @LukeMoody01 diving a bit more into the bottlenecks and optimisations you have mentioned - any chance this was AI generated? Because this isn't really making sense to me based off of the code. For example
> 
> > No caching when clip geometry hasn't changed.
> > Platform view layer creation for each blur instance on every frame
> 
> As I understand `@property(nonatomic) NSMutableArray<UIVisualEffectView*>* backdropFilterSubviews;` is storing the filters and those are being reused
> 
> ```
> if (self.backdropFilterSubviews.count <= index) {
>       backdropFilterView = filter.backdropFilterView;
>       [self addSubview:backdropFilterView];
>       [self.backdropFilterSubviews addObject:backdropFilterView];
>     } else {
>       [filter updateVisualEffectView:self.backdropFilterSubviews[index]];
>     }
> ```
> 
> I did have some stray logs I had added in this PR that I have now removed, can you try rerunning your performance benchmark? I think the perf hit just came from those rather than anything else

Bottlenecks were indeed AI-generated based on your git diff, engine code isn‚Äôt my usual domain, so I‚Äôd take those suggestions with a healthy grain of salt.

The performance data, however, is real, measured directly from a production-level test. I can share that along with a small reproducible repo sometime in the coming weeks.

Re your question, we have roughly four rounded-blur overlays layered on top of a scrollable platform view (a webview in this case).

I will also retest now that you have removed the logs"
"> Bottlenecks were indeed AI-generated based on your git diff, engine code isn‚Äôt my usual domain, so I‚Äôd take those suggestions with a healthy grain of salt.

Please avoid these IMO. While its obviously helpful to test it out and share the performance you saw, if unfamiliar its better not to comment on bottlenecks and fixes rather than use AI and give wrong suggestions which ended up wasting my time trying to make sense of it"
"## Demonstrating issue and fix

Simple demo showing flutter xcode behavior before and after fix.

```console
/tmp on ‚òÅÔ∏è  jimmyff
‚ûú flutter create my_app --platforms macos
Creating project my_app...
Resolving dependencies in `my_app`... 
Downloading packages... 
Got dependencies in `my_app`.
Wrote 39 files.

All done!
You can find general documentation for Flutter at: https://docs.flutter.dev/
Detailed API documentation is available at: https://api.flutter.dev/
If you prefer video documentation, consider: https://www.youtube.com/c/flutterdev

In order to run your application, type:

  $ cd my_app
  $ flutter run

Your application code is in my_app/lib/main.dart.


/tmp on ‚òÅÔ∏è  jimmyff
‚ûú cd my_app/
```

## flutter without fix
```console
/tmp/my_app is üì¶ v1.0.0+1 via üéØ v3.9.0 on ‚òÅÔ∏è  jimmyff
‚ûú flutter run --debug --device-id macos
Resolving dependencies... 
Downloading packages... 
  characters 1.4.0 (1.4.1 available)
  flutter_lints 5.0.0 (6.0.0 available)
  lints 5.1.1 (6.0.0 available)
  material_color_utilities 0.11.1 (0.13.0 available)
  meta 1.16.0 (1.17.0 available)
  test_api 0.7.6 (0.7.7 available)
Got dependencies!
6 packages have newer versions incompatible with dependency constraints.
Try `flutter pub outdated` for more information.
Launching lib/main.dart on macOS in debug mode...
Target debug_unpack_macos failed: Error: Flutter failed to create a directory at ""/nix/store/vp16mw78rjzca3ar9whk0cni9z0q25ag-flutter-3.35.2-unwrapped/bin/cache/artifacts"".
Please ensure that the SDK and/or project is installed in a location that has read/write permissions for the current user.

Target kernel_snapshot_program failed: Error: Flutter failed to create a directory at ""/nix/store/vp16mw78rjzca3ar9whk0cni9z0q25ag-flutter-3.35.2-unwrapped/bin/cache/artifacts"".
Please ensure that the SDK and/or project is installed in a location that has read/write permissions for the current user.
Failed to package /private/tmp/my_app.
Command PhaseScriptExecution failed with a nonzero exit code
warning: Run script build phase 'Run Script' will be run during every build because it does not specify any outputs. To address this issue, either add output dependencies to the script phase, or configure it to run in every build by unchecking ""Based on dependency analysis"" in the script phase. (in target 'Flutter Assemble' from project 'Runner')
** BUILD FAILED **

Building macOS application...                                           
Error: Build process failed

```

## flutter with fix

```console
/tmp/my_app is üì¶ v1.0.0+1 via üéØ v3.10.0-227.0.dev on ‚òÅÔ∏è  jimmyff took 3s 
‚ûú flutter run -d macos
Resolving dependencies... 
Downloading packages... 
  characters 1.4.0 (1.4.1 available)
  flutter_lints 5.0.0 (6.0.0 available)
  lints 5.1.1 (6.0.0 available)
  material_color_utilities 0.11.1 (0.13.0 available)
> meta 1.17.0 (was 1.16.0)
> test_api 0.7.7 (was 0.7.6)
Changed 2 dependencies!
4 packages have newer versions incompatible with dependency constraints.
Try `flutter pub outdated` for more information.
Launching lib/main.dart on macOS in debug mode...
warning: Run script build phase 'Run Script' will be run during every build because it does not specify any outputs. To address this issue, either add output dependencies to the script phase, or configure it to run in every build by unchecking ""Based on dependency analysis"" in the script phase. (in target 'Flutter Assemble' from project 'Runner')
Building macOS application...                                           
‚úì Built build/macos/Build/Products/Debug/my_app.app
2025-09-23 12:57:20.920 my_app[12852:100362] Running with merged UI and platform thread. Experimental.
Failed to foreground app; open returned 1
Syncing files to device macOS...                                    41ms

Flutter run key commands.
r Hot reload. üî•üî•üî•
R Hot restart.
h List all available interactive commands.
d Detach (terminate ""flutter run"" but leave application running).
c Clear the screen
q Quit (terminate the application on the device).

A Dart VM Service on macOS is available at: http://127.0.0.1:49765/V1pkzVVXexM=/
The Flutter DevTools debugger and profiler on macOS is available at:
http://127.0.0.1:49765/V1pkzVVXexM=/devtools/uri=ws://127.0.0.1:49765/V1pkzVVXexM=/ws
```"
"Hey @vashworth any chance of a review? would love to get this through to get flutter + ios/macos working on nix.

Thanks"
@jimmyff hello! are you able to make requested changes? 
"> Can you add a test that verify the modal route has this new property?

Added new test case."
"> just one last concern

For the MergeSemantics forced merge case, I implemented ""first non-defer wins"". This is consistent with how role and inputType are merged.

In your example:
MergeSemantics(
  child: Semantics(hitTestBehavior: .opaque,
    child: Semantics(hitTestBehavior: .transparent, ...)
  )
)
Currently: parent's .opaque wins (since parent is visited before children)
Is this the intended behavior?  Or Implement priority ordering, for example, opaque > transparent > defer, so the most restrictive value wins?"
skwasm_2 is flakey: https://ci.chromium.org/ui/p/flutter/builders/try/Linux%20web_skwasm_tests_2
Waiting for current tests to complete before pushing (hopefully) last change. Color me surprised that flutter slow tests needs ninja.
All presubmits are passing - landing
Failed to create CP due to merge conflicts.<br>You will need to create the PR manually. See [the cherrypick wiki](https://github.com/flutter/flutter/blob/main/docs/releases/Flutter-Cherrypick-Process.md) for more info.
Failed to create CP due to merge conflicts.<br>You will need to create the PR manually. See [the cherrypick wiki](https://github.com/flutter/flutter/blob/main/docs/releases/Flutter-Cherrypick-Process.md) for more info.
"> The Skwasm path wrapper needs to be updated before SK_HIDE_PATH_EDIT_METHODS can be enabled (https://github.com/flutter/flutter/blob/master/engine/src/flutter/lib/web_ui/skwasm/path.cpp)

Done"
"Considering exposing a PathBuilder as a dart object, now that Path is logically immutable?
"
Reason for revert: Broke internal tests. Some shapes are not drawn.
"Traced the issue to a difference in behavior in the `Op` function in the `tools/path_ops` library.

I'll submit an update to this PR after the revert lands."
@okorohelijah Google testing is failing but isn't related to your PR. Try re-running the failed tests and if it still fails
Failed to create CP due to merge conflicts.<br>You will need to create the PR manually. See [the cherrypick wiki](https://github.com/flutter/flutter/blob/main/docs/releases/Flutter-Cherrypick-Process.md) for more info.
Commit queue failed; closing this roll.
"I'm taking a look at this, but also cc'd @bkonyi and @mdebbar as head honchos of tools and web, respectively!"
"The latest pushes introduced some analyzer issues, PTAL @salemiranloye!"
"I'm very intestered so I'd like to give it a try but the basic example throw an error :
```
server:
  proxy: 
    - target: ""https://localhost:3000""
      source: ""/api/""
```

`[ProxyRule] Invalid proxy rule in YAML: {target: https://localhost:3000, source: /api/}`

The linked DOC seems outdated"
"@woprandi I'm assuming you are referring to the Google Doc, which is supposed to be a design doc and not final documentation.

Before this goes into a stable flutter release, we'll write official documentation for it.

For now, you can change `source` to `prefix`.

This also tells me we can improve on the error message to point users like yourself in the right direction üôÇ"
Can we report issue about this feature ?
"@woprandi ‚Äì¬†please! In a new issue, though."
"Hi @victorsanni @ValentinVignal , thank you for your review.

Would it be possible to keep `axisAlignment` as deprecated while adding the new `alignment` parameter? This would provide a smooth migration path for existing users while offering a better API for new ones.

Here's what I'm suggesting:

1. Keep both parameters nullable with an assertion to ensure exactly one is provided:
```dart
class SizeTransition extends AnimatedWidget {
  @Deprecated('Use alignment instead.')
  final double? axisAlignment;
  final AlignmentGeometry? alignment;
  ...

  const SizeTransition({
    ...
  }) : assert(axisAlignment != null || alignment != null),
```

2. Update the build method to prioritize alignment when available:
```dart
Widget build(BuildContext context) {
    return ClipRect(
      child: Align(
        alignment: alignment ?? switch (axis) {
          Axis.horizontal => AlignmentDirectional(axisAlignment, -1.0),
          Axis.vertical => AlignmentDirectional(-1.0, axisAlignment),
        },
        ...
```

What are your thoughts on this approach?"
"> Would it be possible to keep axisAlignment as deprecated while adding the new alignment parameter? This would provide a smooth migration path for existing users while offering a better API for new ones.

I'm not sure deprecating a property without a dart fix is a 'smooth' migration. Users will have to manually update their code to adopt the new API, which will require them to re-familiarize themselves with `Alignment` and `SizeTransition` APIs, introducing cognitive load. And this cognitive load seems unnecessary given this API doesn't add any new features or behaviors.

There are other places in the framework with similar concerns, we usually document them in [breaking changes that would improve the overall API](https://github.com/flutter/flutter/issues/24722)."
"Hi @Piinks , happy to update the PR üëç . What do you think of this [approach](https://github.com/flutter/flutter/pull/177895#issuecomment-3483403658)?

Here‚Äôs what I think is still needed:
1. Fix the failing test [Linux customer_testing](https://github.com/flutter/flutter/pull/177895/checks?check_run_id=54371538664)
2. Fix the failing test [Mac customer_testing](https://github.com/flutter/flutter/pull/177895/checks?check_run_id=54371540777)
3. Add deprecation with dart fix

Is there an example of how to implement `3. Add deprecation with dart fix`?
Please let me know if I‚Äôm missing anything.
"
"If this is made backwards compatible, the customer testing likely won't need to be fixed. 
Here is one PR where something was deprecated as an example: #161295
Docs on dart fix: https://github.com/flutter/flutter/blob/master/docs/contributing/Data-driven-Fixes.md"
"Not sure what's up with the failures though. The customer test failure is a Zulip test that looks like a legit failure, but other failures seem to be about a missing file that sounds like an infra problem or something."
Ah maybe it's just https://github.com/flutter/flutter/issues/178060?
"An existing Git SHA, `f2724d0b29b3c5c281ba044e2de21b85940261c6`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
"I clicked the wrong button - yes, this is related to https://github.com/flutter/flutter/issues/178060?"
"tree is green, you might want to just roll again from tip so you have the correct ci.yaml"
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
Perhaps this function was pre-FFI where you needed to get this information from native code? If the purpose is to track windows created in native code and not in the Dart platform then this should be `hasNativeWindows()` and the Dart created windows tracked in a platform independent way.
Commit queue failed; closing this roll.
Commit queue failed; closing this roll.
@harryterkelsen It looks like #177138 replaced the previous `transferFromImageBitmap` and `drawImage` with new CanvasKit APIs. I tried #177138 and no longer encountered the issue #176174. Is there an expected timeline for this change? Is this my fix still necessary? Btw are there any plans to use Impeller on Flutter WebüëÄ?
"Hi @piedcipher, can you change this PR to target `master` instead of `main`?"
"An existing Git SHA, `23d41bb3cdcefbbe89435835ea415176c38d60e8`, was detected, and no actions were taken.

To re-trigger presubmits after closing or re-opeing a PR, or pushing a HEAD commit (i.e. with `--force`) that already was pushed before, push a blank commit (`git commit --allow-empty -m ""Trigger Build""`) or rebase to continue."
Commit queue failed; closing this roll.
Attached a revert g3fix: https://critique.corp.google.com/cl/828282822
Commit queue failed; closing this roll.
reason for revert: The call to `adbPath` causes the tool to fail if ANDROID isn't installed.
